
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="VictoryWoo">
    <title>[Android] MVVM UI Event Wrapper - VictoryWoo</title>
    <meta name="author" content="VictoryWoo">
    
    
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"VictoryWoo","sameAs":["https://github.com/WooVictory","https://www.facebook.com/WooVictory","https://www.linkedin.com/profile/","jhsw0375@gmail.com"],"image":"Victory.jpeg"},"articleBody":"Prologue\n이번 포스팅은 LiveData with SnackBar, Navigation and other events (the SingleLiveEvent case) 글을 번역하여 참고했습니다.\n\nSubject\nView(Activity, Fragment)가 ViewModel과 통신하는 편한 방법은 LiveData와 같은 Observable을 사용하는 것이다. View는 LiveData의 변경 사항을 구독하고 이에 반응한다. 따라서 화면에 지속적으로 표시되는 데이터에 적합하다.\n\n하지만, Snackbar 메시지, navigation(ex. 화면 전환 등) 이벤트, 다이얼로그 같은 일부 데이터는 한 번만 사용해야 한다.\n\n라이브러리나 Architecture Components를 사용해 이 문제를 해결하는 대신, 디자인 문제에 직면하게 된다. 우리는 이벤트를 상태의 일부로 취급하는 것을 권장한다. 아래에서는 일반적인 실수와 권장되는 접근 방식을 보여준다.\n❌ Bad: 1. Using LiveData for events\n이러한 방법은 LiveData 객체 내부에 Snackbar 메세지 또는 Navigation 신호를 보유한다. 원칙적으로 LiveData 객체를 이러한 방식으로 사용하는 것은 일반적인 것처럼 보이나, 몇 가지 문제를 가지고 있다.\n아래의 코드를 확인해보자.\n[ViewModel]\n123456789101112// Don't use this for eventsclass ListViewModel : ViewModel &#123;    private val _navigateToDetails = MutableLiveData&lt;Boolean&gt;()    val navigateToDetails : LiveData&lt;Boolean&gt;        get() = _navigateToDetails    fun userClicksOnButton() &#123;        _navigateToDetails.value = true    &#125;&#125;\n[View(Activity or Fragment)]\n123myViewModel.navigateToDetails.observe(this, Observer &#123;    if (it) startActivity(DetailsActivity...)&#125;)\n\n위 방법의 문제점은 _navigateToDetails의 값이 오랫동안 true이고, 첫 화면으로 돌아갈 수 없다는 것이다.\n아래의 단계를 보자.\n\n\n사용자가 버튼을 클릭하면 Detail Activity를 시작한다.\n사용자가 back 버튼을 클릭하면 Master Activity로 돌아온다.\n옵저버는 Activity가 백스택에 있는 동안 비활성된 후, 다시 활성화 된다.\nvalue는 여전히 true이므로 Detail Activity가 부적절하게 다시 시작된다.\n\n해결책은 ViewModel에서 value를 true로 설정한 뒤, 즉시 false로 설정하는 것이다.\n1234fun userClicksOnButton() &#123;    _navigateToDetails.value = true    _navigateToDetails.value = false // Don't do this&#125;\n하지만, 우리가 기억해야 할 중요한 사항은 LiveData에 값이 있지만 수신하는 모든 값을 방출한다고 보장하지는 않는다. 예를 들어, 옵저버가 활성화되지 않은 경우, 값을 설정할 수 있으므로 새로운 값으로 대체된다. 또한, 다른 스레드에서 값을 설정하면 race condition(경쟁조건)이 발생하여 옵저버에게 한 번만 호출할 수 있다.\n그러나 이 접근 방법의 더 큰 문제점은 이해하기 어렵고 가독성이 떨어진다는 점이다. 그렇다면 이와 같은 Navigation Event(탐색 ex. 화면 전환 및 클릭 등)가 발생한 후 값이 재설정되도록 하려면 어떻게 해야 할까??\n❌ Better: 2. Using LiveData for events, resetting event values in observer\n이 방법을 사용하면 View에서 이벤트를 이미 처리했으며, 재설정해야 함을 나타내는 방법을 추가한다.\n[Usage]\n\n옵저버에 약간의 변화를 주면 이에 대한 해결책을 얻을 수 있다.\n\n123456listViewModel.navigateToDetails.observe(this, Observer &#123;    if (it) &#123;        myViewModel.navigateToDetailsHandled()        startActivity(DetailsActivity...)    &#125;&#125;)\n\nViewModel에 아래와 같은 메소드를 추가해주자.\n\n12345678910111213141516class ListViewModel : ViewModel &#123;    private val _navigateToDetails = MutableLiveData&lt;Boolean&gt;()    val navigateToDetails : LiveData&lt;Boolean&gt;        get() = _navigateToDetails    fun userClicksOnButton() &#123;        _navigateToDetails.value = true    &#125;    // Added    fun navigateToDetailsHandled() &#123;        _navigateToDetails.value = false    &#125;&#125;\n[Issues]\n\n보일러 플레이트 코드(이벤트마다 ViewModel에 새로운 메소드가 하나씩 있다.)가 있다는 점이다.\n옵저버에서 이벤트를 처리하고 ViewModel의 메소드를 호출하는 작업을 잊어버리기 쉽다.\n오류가 발생하기 쉽다.\n\n✔️ OK: Use SingleLiveEvent\nSingleLiveEvent 클래스는 특정 시나리오에 적합한 솔루션으로 Sample로 작성되었다. 한 번만 업데이트를 보내는 LiveData이다.\n[Usage]\n1234567891011class ListViewModel : ViewModel &#123;    private val _navigateToDetails = SingleLiveEvent&lt;Any&gt;()    val navigateToDetails : LiveData&lt;Any&gt;        get() = _navigateToDetails    fun userClicksOnButton() &#123;        _navigateToDetails.call()    &#125;&#125;\n123myViewModel.navigateToDetails.observe(this, Observer &#123;    startActivity(DetailsActivity...)&#125;)\n[Issues]\n\nSingleLiveEvent의 문제점은 하나의 관찰자로 제한된다는 것이다. 실수로 둘 이상을 추가하면 하나만 호출되며 어떤 것을 보장하지 않는다.\n\n\n✔️ Recommended: Use an Event Wrapper\n이 방법은 이벤트 처리 여부를 명시적으로 관리하여 실수를 줄인다.\n[Usage]\n\nEvent\n\n12345678910111213141516171819202122232425/** * Used as a wrapper for data that is exposed via a LiveData that represents an event. */open class Event&lt;out T&gt;(private val content: T) &#123;    var hasBeenHandled = false        private set // Allow external read but not write    /**     * Returns the content and prevents its use again.     */    fun getContentIfNotHandled(): T? &#123;        return if (hasBeenHandled) &#123;            null        &#125; else &#123;            hasBeenHandled = true            content        &#125;    &#125;    /**     * Returns the content, even if it's already been handled.     */    fun peekContent(): T = content&#125;\n\nViewModel\n\n1234567891011class ListViewModel : ViewModel &#123;    private val _navigateToDetails = MutableLiveData&lt;Event&lt;String&gt;&gt;()    val navigateToDetails : LiveData&lt;Event&lt;String&gt;&gt;        get() = _navigateToDetails    fun userClicksOnButton(itemId: String) &#123;        _navigateToDetails.value = Event(itemId)  // Trigger the event by setting a new Event as a new value    &#125;&#125;\n\nView\n\n12345myViewModel.navigateToDetails.observe(this, Observer &#123;    it.getContentIfNotHandled()?.let &#123; // Only proceed if the event has never been handled        startActivity(DetailsActivity...)    &#125;&#125;)\n장점은 사용자가 getContentIfNotHandled() 또는 peekContent()를 사용하여 의도를 지정해야 한다는 것이다. 이벤트를 상태의 일부로 모델링한다. 이제는 단순히 소비되었거나 사용하지 않은 메시지이다.\n\nIn Summary\n\n이벤트를 상태의 일부로 디자인해라.\nLiveData Observable에서 자체 이벤트 래퍼를 사용하고 필요에 맞게 사용자 정의하라.\n\nBonus!\n\n많은 이벤트가 발생하면 EventObserver를 사용하여 반복적인 코드를 제거하라.\n\nReference\n\nLiveData with SnackBar, Navigation and other events (the SingleLiveEvent case)\n\n","dateCreated":"2020-07-08T10:34:10+09:00","dateModified":"2020-07-21T23:05:05+09:00","datePublished":"2020-07-08T10:34:10+09:00","description":"Prologue\n이번 포스팅은 LiveData with SnackBar, Navigation and other events (the SingleLiveEvent case) 글을 번역하여 참고했습니다.","headline":"[Android] MVVM UI Event Wrapper","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://woovictory.github.io/2020/07/08/Android-SingleLiveEventToEventWrapper/"},"publisher":{"@type":"Organization","name":"VictoryWoo","sameAs":["https://github.com/WooVictory","https://www.facebook.com/WooVictory","https://www.linkedin.com/profile/","jhsw0375@gmail.com"],"image":"Victory.jpeg","logo":{"@type":"ImageObject","url":"Victory.jpeg"}},"url":"https://woovictory.github.io/2020/07/08/Android-SingleLiveEventToEventWrapper/","keywords":"Android, MVVM, UI Event, SingleLiveEvent, Event Wrapper"}</script>
    <meta name="description" content="Prologue 이번 포스팅은 LiveData with SnackBar, Navigation and other events (the SingleLiveEvent case) 글을 번역하여 참고했습니다.">
<meta name="keywords" content="Android,MVVM,UI Event,SingleLiveEvent,Event Wrapper">
<meta property="og:type" content="blog">
<meta property="og:title" content="[Android] MVVM UI Event Wrapper">
<meta property="og:url" content="https://woovictory.github.io/2020/07/08/Android-SingleLiveEventToEventWrapper/index.html">
<meta property="og:site_name" content="VictoryWoo">
<meta property="og:description" content="Prologue 이번 포스팅은 LiveData with SnackBar, Navigation and other events (the SingleLiveEvent case) 글을 번역하여 참고했습니다.">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://woovictory.github.io/img/liveData1.png">
<meta property="og:image" content="https://woovictory.github.io/img/liveData2.png">
<meta property="og:image" content="https://woovictory.github.io/img/liveData3.png">
<meta property="og:image" content="https://woovictory.github.io/img/liveData4.png">
<meta property="og:updated_time" content="2020-07-21T14:05:05.262Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="[Android] MVVM UI Event Wrapper">
<meta name="twitter:description" content="Prologue 이번 포스팅은 LiveData with SnackBar, Navigation and other events (the SingleLiveEvent case) 글을 번역하여 참고했습니다.">
<meta name="twitter:image" content="https://woovictory.github.io/img/liveData1.png">
    
    
        
    
    
        <meta property="og:image" content="https://woovictory.github.io/assets/images/Victory.jpeg"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/all.css">
    <link rel="stylesheet" href="/assets/css/jquery.fancybox.css">
    <link rel="stylesheet" href="/assets/css/thumbs.css">
    <link rel="stylesheet" href="/assets/css/tranquilpeak.css">
    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-125410253-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-125410253-1');
    </script>


    

    
        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="2">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/ "
            aria-label=""
        >
            VictoryWoo
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/Victory.jpeg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="2">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="Read more about the author"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/Victory.jpeg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">VictoryWoo</h4>
                
                    <h5 class="sidebar-profile-bio"><p>기록을 통해 사람들과 공유하는 것을 좋아합니다.</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="Search"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Search</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/WooVictory"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.facebook.com/WooVictory"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Facebook"
                        >
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/profile/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/jhsw0375@gmail.com"
                            
                            rel="noopener"
                            title="Mail"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="2"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            [Android] MVVM UI Event Wrapper
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2020-07-08T10:34:10+09:00">
	
		    Jul 08, 2020
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Android/">Android</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <h3 id="prologue">Prologue</h3>
<p>이번 포스팅은 <a href="https://medium.com/androiddevelopers/livedata-with-snackbar-navigation-and-other-events-the-singleliveevent-case-ac2622673150" target="_blank" rel="noopener">LiveData with SnackBar, Navigation and other events (the SingleLiveEvent case)</a> 글을 번역하여 참고했습니다.</p>
<a id="more"></a>
<h3 id="subject">Subject</h3>
<p>View(Activity, Fragment)가 ViewModel과 통신하는 편한 방법은 <code>LiveData</code>와 같은 Observable을 사용하는 것이다. View는 LiveData의 변경 사항을 구독하고 이에 반응한다. 따라서 화면에 지속적으로 표시되는 데이터에 적합하다.</p>
<img src="/img/liveData1.png">
<p>하지만, Snackbar 메시지, navigation(ex. 화면 전환 등) 이벤트, 다이얼로그 같은 일부 데이터는 한 번만 사용해야 한다.</p>
<img src="/img/liveData2.png">
<p>라이브러리나 Architecture Components를 사용해 이 문제를 해결하는 대신, 디자인 문제에 직면하게 된다. 우리는 이벤트를 상태의 일부로 취급하는 것을 권장한다. 아래에서는 일반적인 실수와 권장되는 접근 방식을 보여준다.</p>
<h3 id="bad-1-using-livedata-for-events">❌ Bad: 1. Using LiveData for events</h3>
<p>이러한 방법은 <strong>LiveData</strong> 객체 내부에 Snackbar 메세지 또는 Navigation 신호를 보유한다. 원칙적으로 <strong>LiveData</strong> 객체를 이러한 방식으로 사용하는 것은 일반적인 것처럼 보이나, 몇 가지 문제를 가지고 있다.</p>
<p>아래의 코드를 확인해보자.</p>
<p><strong>[ViewModel]</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Don't use this for events</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListViewModel</span> : <span class="type">ViewModel &#123;</span></span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> _navigateToDetails = MutableLiveData&lt;<span class="built_in">Boolean</span>&gt;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> navigateToDetails : LiveData&lt;<span class="built_in">Boolean</span>&gt;</span><br><span class="line">        <span class="keyword">get</span>() = _navigateToDetails</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">userClicksOnButton</span><span class="params">()</span></span> &#123;</span><br><span class="line">        _navigateToDetails.value = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>[View(Activity or Fragment)]</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">myViewModel.navigateToDetails.observe(<span class="keyword">this</span>, Observer &#123;</span><br><span class="line">    <span class="keyword">if</span> (it) startActivity(DetailsActivity...)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>위 방법의 문제점은 <code>_navigateToDetails</code>의 값이 오랫동안 true이고, 첫 화면으로 돌아갈 수 없다는 것이다.</li>
<li>아래의 단계를 보자.</li>
</ul>
<ol>
<li>사용자가 버튼을 클릭하면 Detail Activity를 시작한다.</li>
<li>사용자가 back 버튼을 클릭하면 Master Activity로 돌아온다.</li>
<li>옵저버는 Activity가 백스택에 있는 동안 비활성된 후, 다시 활성화 된다.</li>
<li>value는 여전히 true이므로 Detail Activity가 부적절하게 다시 시작된다.</li>
</ol>
<p>해결책은 ViewModel에서 value를 true로 설정한 뒤, 즉시 false로 설정하는 것이다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">userClicksOnButton</span><span class="params">()</span></span> &#123;</span><br><span class="line">    _navigateToDetails.value = <span class="literal">true</span></span><br><span class="line">    _navigateToDetails.value = <span class="literal">false</span> <span class="comment">// Don't do this</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>하지만, 우리가 기억해야 할 중요한 사항은 LiveData에 값이 있지만 수신하는 모든 값을 방출한다고 보장하지는 않는다. 예를 들어, 옵저버가 활성화되지 않은 경우, 값을 설정할 수 있으므로 새로운 값으로 대체된다. 또한, 다른 스레드에서 값을 설정하면 <code>race condition(경쟁조건)</code>이 발생하여 옵저버에게 한 번만 호출할 수 있다.</p>
<p>그러나 이 접근 방법의 더 큰 문제점은 이해하기 어렵고 가독성이 떨어진다는 점이다. 그렇다면 이와 같은 Navigation Event(탐색 ex. 화면 전환 및 클릭 등)가 발생한 후 값이 재설정되도록 하려면 어떻게 해야 할까??</p>
<h3 id="better-2-using-livedata-for-events-resetting-event-values-in-observer">❌ Better: 2. Using LiveData for events, resetting event values in observer</h3>
<p>이 방법을 사용하면 View에서 이벤트를 이미 처리했으며, 재설정해야 함을 나타내는 방법을 추가한다.</p>
<p><strong>[Usage]</strong></p>
<ul>
<li>옵저버에 약간의 변화를 주면 이에 대한 해결책을 얻을 수 있다.</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">listViewModel.navigateToDetails.observe(<span class="keyword">this</span>, Observer &#123;</span><br><span class="line">    <span class="keyword">if</span> (it) &#123;</span><br><span class="line">        myViewModel.navigateToDetailsHandled()</span><br><span class="line">        startActivity(DetailsActivity...)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>ViewModel에 아래와 같은 메소드를 추가해주자.</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListViewModel</span> : <span class="type">ViewModel &#123;</span></span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> _navigateToDetails = MutableLiveData&lt;<span class="built_in">Boolean</span>&gt;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> navigateToDetails : LiveData&lt;<span class="built_in">Boolean</span>&gt;</span><br><span class="line">        <span class="keyword">get</span>() = _navigateToDetails</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">userClicksOnButton</span><span class="params">()</span></span> &#123;</span><br><span class="line">        _navigateToDetails.value = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Added</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">navigateToDetailsHandled</span><span class="params">()</span></span> &#123;</span><br><span class="line">        _navigateToDetails.value = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>[Issues]</strong></p>
<ul>
<li>보일러 플레이트 코드(이벤트마다 ViewModel에 새로운 메소드가 하나씩 있다.)가 있다는 점이다.</li>
<li>옵저버에서 이벤트를 처리하고 ViewModel의 메소드를 호출하는 작업을 잊어버리기 쉽다.</li>
<li>오류가 발생하기 쉽다.</li>
</ul>
<h3 id="️-ok-use-singleliveevent">✔️ OK: Use SingleLiveEvent</h3>
<p><code>SingleLiveEvent</code> 클래스는 특정 시나리오에 적합한 솔루션으로 Sample로 작성되었다. 한 번만 업데이트를 보내는 LiveData이다.</p>
<p><strong>[Usage]</strong></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListViewModel</span> : <span class="type">ViewModel &#123;</span></span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> _navigateToDetails = SingleLiveEvent&lt;Any&gt;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> navigateToDetails : LiveData&lt;Any&gt;</span><br><span class="line">        <span class="keyword">get</span>() = _navigateToDetails</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">userClicksOnButton</span><span class="params">()</span></span> &#123;</span><br><span class="line">        _navigateToDetails.call()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">myViewModel.navigateToDetails.observe(<span class="keyword">this</span>, Observer &#123;</span><br><span class="line">    startActivity(DetailsActivity...)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>[Issues]</strong></p>
<ul>
<li><code>SingleLiveEvent</code>의 문제점은 하나의 관찰자로 제한된다는 것이다. 실수로 둘 이상을 추가하면 하나만 호출되며 어떤 것을 보장하지 않는다.</li>
</ul>
<img src="/img/liveData3.png">
<h3 id="️-recommended-use-an-event-wrapper">✔️ Recommended: Use an Event Wrapper</h3>
<p>이 방법은 이벤트 처리 여부를 명시적으로 관리하여 실수를 줄인다.</p>
<p><strong>[Usage]</strong></p>
<ul>
<li>Event</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Used as a wrapper for data that is exposed via a LiveData that represents an event.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Event</span>&lt;<span class="type">out T</span>&gt;</span>(<span class="keyword">private</span> <span class="keyword">val</span> content: T) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> hasBeenHandled = <span class="literal">false</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">set</span> <span class="comment">// Allow external read but not write</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the content and prevents its use again.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getContentIfNotHandled</span><span class="params">()</span></span>: T? &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">if</span> (hasBeenHandled) &#123;</span><br><span class="line">            <span class="literal">null</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            hasBeenHandled = <span class="literal">true</span></span><br><span class="line">            content</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the content, even if it's already been handled.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">peekContent</span><span class="params">()</span></span>: T = content</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ViewModel</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListViewModel</span> : <span class="type">ViewModel &#123;</span></span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> _navigateToDetails = MutableLiveData&lt;Event&lt;String&gt;&gt;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> navigateToDetails : LiveData&lt;Event&lt;String&gt;&gt;</span><br><span class="line">        <span class="keyword">get</span>() = _navigateToDetails</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">userClicksOnButton</span><span class="params">(itemId: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">        _navigateToDetails.value = Event(itemId)  <span class="comment">// Trigger the event by setting a new Event as a new value</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>View</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">myViewModel.navigateToDetails.observe(<span class="keyword">this</span>, Observer &#123;</span><br><span class="line">    it.getContentIfNotHandled()?.let &#123; <span class="comment">// Only proceed if the event has never been handled</span></span><br><span class="line">        startActivity(DetailsActivity...)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>장점은 사용자가 getContentIfNotHandled() 또는 peekContent()를 사용하여 의도를 지정해야 한다는 것이다. 이벤트를 상태의 일부로 모델링한다. 이제는 단순히 소비되었거나 사용하지 않은 메시지이다.</p>
<img src="/img/liveData4.png">
<h3 id="in-summary">In Summary</h3>
<ul>
<li>이벤트를 상태의 일부로 디자인해라.</li>
<li>LiveData Observable에서 자체 이벤트 래퍼를 사용하고 필요에 맞게 사용자 정의하라.</li>
</ul>
<h3 id="bonus">Bonus!</h3>
<ul>
<li>많은 이벤트가 발생하면 <a href="https://gist.github.com/JoseAlcerreca/e0bba240d9b3cffa258777f12e5c0ae9" target="_blank" rel="noopener">EventObserver</a>를 사용하여 반복적인 코드를 제거하라.</li>
</ul>
<h3 id="reference">Reference</h3>
<ul>
<li><a href="https://medium.com/androiddevelopers/livedata-with-snackbar-navigation-and-other-events-the-singleliveevent-case-ac2622673150" target="_blank" rel="noopener">LiveData with SnackBar, Navigation and other events (the SingleLiveEvent case)</a></li>
</ul>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/Android/">Android</a> <a class="tag tag--primary tag--small t-link" href="/tags/Event-Wrapper/">Event Wrapper</a> <a class="tag tag--primary tag--small t-link" href="/tags/MVVM/">MVVM</a> <a class="tag tag--primary tag--small t-link" href="/tags/SingleLiveEvent/">SingleLiveEvent</a> <a class="tag tag--primary tag--small t-link" href="/tags/UI-Event/">UI Event</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2020/07/21/CleanCode4/"
                    data-tooltip="[CleanCode] 4장. 주석"
                    aria-label="PREVIOUS: [CleanCode] 4장. 주석"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2020/07/06/CleanCode-3/"
                    data-tooltip="[CleanCode] 3장. 함수"
                    aria-label="NEXT: [CleanCode] 3장. 함수"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://woovictory.github.io/2020/07/08/Android-SingleLiveEventToEventWrapper/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://woovictory.github.io/2020/07/08/Android-SingleLiveEventToEventWrapper/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://woovictory.github.io/2020/07/08/Android-SingleLiveEventToEventWrapper/"
                    title="Share on Google+"
                    aria-label="Share on Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#disqus_thread"
                        aria-label="Leave a comment"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
                <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2020 VictoryWoo. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="2">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2020/07/21/CleanCode4/"
                    data-tooltip="[CleanCode] 4장. 주석"
                    aria-label="PREVIOUS: [CleanCode] 4장. 주석"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2020/07/06/CleanCode-3/"
                    data-tooltip="[CleanCode] 3장. 함수"
                    aria-label="NEXT: [CleanCode] 3장. 함수"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://woovictory.github.io/2020/07/08/Android-SingleLiveEventToEventWrapper/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://woovictory.github.io/2020/07/08/Android-SingleLiveEventToEventWrapper/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://woovictory.github.io/2020/07/08/Android-SingleLiveEventToEventWrapper/"
                    title="Share on Google+"
                    aria-label="Share on Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#disqus_thread"
                        aria-label="Leave a comment"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="2">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://woovictory.github.io/2020/07/08/Android-SingleLiveEventToEventWrapper/"
                        aria-label="Share on Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://woovictory.github.io/2020/07/08/Android-SingleLiveEventToEventWrapper/"
                        aria-label="Share on Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://plus.google.com/share?url=https://woovictory.github.io/2020/07/08/Android-SingleLiveEventToEventWrapper/"
                        aria-label="Share on Google+"
                    >
                        <i class="fab fa-google-plus" aria-hidden="true"></i><span>Share on Google+</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/Victory.jpeg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">VictoryWoo</h4>
        
            <div id="about-card-bio"><p>기록을 통해 사람들과 공유하는 것을 좋아합니다.</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Android Developer</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/color_blue.jpeg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/jquery.js"></script>
<script src="/assets/js/jquery.fancybox.js"></script>
<script src="/assets/js/thumbs.js"></script>
<script src="/assets/js/tranquilpeak.js"></script>
<!--SCRIPTS END-->


    
        <script>
          var disqus_config = function() {
            this.page.url = 'https://woovictory.github.io/2020/07/08/Android-SingleLiveEventToEventWrapper/';
              
            this.page.identifier = '2020/07/08/Android-SingleLiveEventToEventWrapper/';
              
          };
          (function() {
            var d = document, s = d.createElement('script');
            var disqus_shortname = 'https-woovictory-github-io';
            s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
          })();
        </script>
    




    </body>
</html>
