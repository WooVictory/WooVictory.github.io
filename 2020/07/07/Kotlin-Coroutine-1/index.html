<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />

    

    
    <title>[Kotlin] Coroutine 이해하기 | VictoryWoo</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
        <meta name="keywords" content="Kotlin,코틀린,Coroutine,코루틴" />
    
    <meta name="description" content="Prologue  코루틴은 코틀린만의 것이 아니다. 이름 때문에 코틀린만의 개념이라고 이해할 수 있지만 파이썬, C#, Go, Javascript 등 여러 언어에서 지원하고 있는 개념이다. (필자도 처음에는 코틀린만의 개념인 줄 알았다…) Javascript를 사용하면서 async / await를 사용하고 있다면 이미 코루틴을 사용해본 경험이 있는 것이다.">
<meta name="keywords" content="Kotlin,코틀린,Coroutine,코루틴">
<meta property="og:type" content="article">
<meta property="og:title" content="[Kotlin] Coroutine 이해하기">
<meta property="og:url" content="https://woovictory.github.io/2020/07/07/Kotlin-Coroutine-1/index.html">
<meta property="og:site_name" content="VictoryWoo">
<meta property="og:description" content="Prologue  코루틴은 코틀린만의 것이 아니다. 이름 때문에 코틀린만의 개념이라고 이해할 수 있지만 파이썬, C#, Go, Javascript 등 여러 언어에서 지원하고 있는 개념이다. (필자도 처음에는 코틀린만의 개념인 줄 알았다…) Javascript를 사용하면서 async / await를 사용하고 있다면 이미 코루틴을 사용해본 경험이 있는 것이다.">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6835b099-fdd6-4341-aae2-55d3bc10777a/Untitled.png">
<meta property="og:updated_time" content="2020-07-22T02:56:20.115Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="[Kotlin] Coroutine 이해하기">
<meta name="twitter:description" content="Prologue  코루틴은 코틀린만의 것이 아니다. 이름 때문에 코틀린만의 개념이라고 이해할 수 있지만 파이썬, C#, Go, Javascript 등 여러 언어에서 지원하고 있는 개념이다. (필자도 처음에는 코틀린만의 개념인 줄 알았다…) Javascript를 사용하면서 async / await를 사용하고 있다면 이미 코루틴을 사용해본 경험이 있는 것이다.">
<meta name="twitter:image" content="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6835b099-fdd6-4341-aae2-55d3bc10777a/Untitled.png">
    

    

    
        <link rel="icon" href="/css/images/victorywoo.png" />
    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/titillium-web/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" type="text/css" href="">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/theeluwin/NotoSansKR-Hestia@master/stylesheets/NotoSansKR-Hestia.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/nanumgothiccoding.css">
    
    
    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/3.3.1/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
        <script type="text/javascript">
(function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-125410253-1', 'auto');
ga('send', 'pageview');

</script>
    
    


</head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" class="logo"></a>
                    </h1>
                    
                        <h2 class="subtitle-wrap">
                            <p class="subtitle">VictoryWoo&#39;s Blog</p>
                        </h2>
                    
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/">Home</a>
                                </li>
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/about/index.html">About</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/Kotlin/">Kotlin</a>
    </h1>
</div>

                        <div class="main-body-content">
                            
                            <article id="post-Kotlin-Coroutine-1" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        [Kotlin] Coroutine 이해하기
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
        <a href="/2020/07/07/Kotlin-Coroutine-1/" class="article-date">
            <time datetime="2020-07-07T02:05:54.000Z" itemprop="datePublished">2020-07-07</time>
        </a>
    </div>

		

                
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/Coroutine/">Coroutine</a>, <a class="tag-link" href="/tags/Kotlin/">Kotlin</a>, <a class="tag-link" href="/tags/코루틴/">코루틴</a>, <a class="tag-link" href="/tags/코틀린/">코틀린</a>
    </div>

            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <h3 id="prologue">Prologue</h3>
<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6835b099-fdd6-4341-aae2-55d3bc10777a/Untitled.png" alt="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6835b099-fdd6-4341-aae2-55d3bc10777a/Untitled.png"></p>
<p>코루틴은 코틀린만의 것이 아니다. 이름 때문에 코틀린만의 개념이라고 이해할 수 있지만 파이썬, C#, Go, Javascript 등 여러 언어에서 지원하고 있는 개념이다. (필자도 처음에는 코틀린만의 개념인 줄 알았다…) Javascript를 사용하면서 async / await를 사용하고 있다면 이미 코루틴을 사용해본 경험이 있는 것이다.</p>
<a id="more"></a>
<p>아무튼 코루틴은 새로운 개념, 새로운 기술이 아니라 프로그래밍이 세상에 나온 초창기부터 존재하던 개념이다.</p>
<h3 id="코틀린-코루틴을-공부해볼-가치가-있는-이유">코틀린 코루틴을 공부해볼 가치가 있는 이유</h3>
<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e7b40f07-9980-4d1a-a14d-b0684e812990/Untitled.png" alt="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e7b40f07-9980-4d1a-a14d-b0684e812990/Untitled.png"></p>
<p>앱이든 웹이든 비동기 처리가 핵심인 클라이언트 프로그래밍에서 항상 핫한 키워드는 <code>Rx Programming</code>일 것이다. 그러나 구글이 안드로이드 공식 언어를 자바에서 코틀린으로 변경한 이후, 최근 들어서 대표적인 Sample Code들인 <a href="https://github.com/android/architecture-samples" target="_blank" rel="noopener">Blueprint</a>와 <a href="https://github.com/android/sunflower" target="_blank" rel="noopener">Sunflower</a> 앱의 비동기 처리를 코루틴으로 바꾸고 있다.</p>
<p>Rx 라이브러리를 걷어내고 <code>Coroutine</code>으로 새로 작성한 것이다. 이와 더불어 상당히 많은 외국 자료들이 올라오고 있다. 그 이유는 코루틴을 사용하면 비동기 처리가 너무나도 쉽게 이루어 질 수 있기 때문이라고 생각한다.</p>
<p>개인적인 생각을 더하자면, Rx는 다양하고 강력한 연산자를 제공하고 비동기 처리도 훨씬 간단하게 할 수 있지만 그만큼 학습 곡선이 높다. 다양한 기능을 제공하지만, 그만큼 Rx를 활용하는 부분이 일부는 비동기 처리에 한정적인 것도 있는 것 같다. 따라서 비동기 처리를 하기 위해 Rx를 적용하기 보다는 코루틴을 사용하는 게 더 나을 수도 있다는 의견이다.</p>
<p>위의 이유만으로 코루틴을 공부해 볼 가치는 충분하다고 생각한다.</p>
<h3 id="coroutine">Coroutine</h3>
<p>아래 3가지 키워드로 알아볼 수 있을 것 같다.</p>
<ol>
<li>협력형 멀티 태스킹</li>
<li>동시성 프로그래밍 지원</li>
<li>비동기 처리를 쉽게 도와줌</li>
</ol>
<h3 id="1-협력형-멀티-태스킹">1) 협력형 멀티 태스킹</h3>
<p>협력형 멀티 태스킹을 프로그래밍 언어로 표현하자만 <strong>Co + Routine</strong> 이다.</p>
<p><code>Co</code> - ‘협력’, '함께’라는 의미를 지니고 있다.</p>
<p><code>Routine</code> - 하나의 태스크, 함수 정도로 생각하면 된다.</p>
<p>즉, 협력하는 함수이다. 이번에는 Routine에 대해서 알아보자.</p>
<p>Routine에는 우리가 알고 있는 Main routine과 Sub routine이 존재한다.</p>
<p>생소할 수도 있지만, 우리가 늘 작성하고 있는 코드이다.</p>
<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/bc00eb66-5bcc-4a5b-959a-4a030b889c0f/Untitled.png" alt="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/bc00eb66-5bcc-4a5b-959a-4a030b889c0f/Untitled.png"></p>
<p>main 함수는 말 그대로 메인이 되는 함수이다. 그리고 메인이 되는 함수는 다른 서브 함수인 plueOne을 호출한다. 우리가 짜는 프로그램은 흔히 이렇게 구성되어 있다.</p>
<p>Sub Routine을 살펴보면 한 가지 특징이 있다. 아래 그림을 보자.</p>
<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/96a5e30a-e791-48ef-850d-83ec5c2c7e11/Untitled.png" alt="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/96a5e30a-e791-48ef-850d-83ec5c2c7e11/Untitled.png"></p>
<p>그림에서 보듯이, Sub Routine은 루틴에 진입하는 지점과 루틴을 빠져나오는 지점이 명확하다. 즉, 메인 루틴이 서브 루틴을 호출하면 서브 루틴의 맨 처음 부분에 진입하여 <code>return</code> 문을 만나거나 서브 루틴의 닫는 괄호를 만나면 해당 서브 루틴을 빠져나오게 된다.</p>
<p>아래의 코드를 보자.</p>
<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/2a615c4d-6a0f-44a3-82fb-9802c4be7b81/Untitled.png" alt="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/2a615c4d-6a0f-44a3-82fb-9802c4be7b81/Untitled.png"></p>
<p>메인 스레드가 <code>plusOne</code>이라는 서브 루틴에 진입한다. 코드는 처음부터 진입되어 윗줄부터 실행될 것이고 그 아래 코드들을 순차적으로 실행해서 <code>return</code> 문을 만나면 서브 루틴을 호출했던 부분으로 탈출한다. 그리고 진입점과 탈출점 사이에 쓰레드는 블락되어있다. 우리가 늘 짜는 코드라 이해가 쉽다.</p>
<p>그러나 Coroutine은 조금 다르다.</p>
<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c7f7c7fd-a59c-4370-8d0f-6138a4820afe/Untitled.png" alt="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c7f7c7fd-a59c-4370-8d0f-6138a4820afe/Untitled.png"></p>
<p>코루틴을 처음 접한다면 혼란스러운 그림일 수 있다.</p>
<p>코루틴도 routine이기 때문에 하나의 함수로 생각하자. 그런데 이 함수에 진입할 수 있는 진입점도 여러개이고, 함수를 빠져나갈 수 있는 탈출점도 여러개이다. 즉, 코루틴 함수는 꼭 <code>return</code> 문이나 마지막 닫는 괄호를 만나지 않더라도 <strong>언제든지 중간에 나갈 수 있고, 언제든지 다시 나갔던 그 지점으로 들어올 수 있다.</strong></p>
<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c1a063e2-e706-44dc-90f6-45e631b72d81/Untitled.png" alt="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c1a063e2-e706-44dc-90f6-45e631b72d81/Untitled.png"></p>
<p><code>drawPerson</code> 이라는 함수가 있다. 함수 안에는 <code>startCoroutine</code> 이라는 코루틴 빌더가 있다.<strong>(실제로 startCoroutine이라는 빌더는 존재하지 않는다. 다른 방식으로 만들지만, 여기서는 이해를 돕기 위해 startCoroutine이라고 사용한다.)</strong></p>
<p>startCoroutine 이라는 코루틴을 만나게 되면 해당 함수는 코루틴으로 작동할 수 있다. 따라서 언제든 함수 실행 중간에 나갈 수도 있고, 다시 들어올 수도 있는 자격이 부여된다.</p>
<p>Q. 언제 코루틴을 중간에 나갈 수 있을까?</p>
<p><code>suspend</code> 로 선언된 함수를 만나면 코루틴 밖으로 잠시 나갈 수 있다.</p>
<p>위의 그림의 코드를 순서대로 따라 가보자.</p>
<ol>
<li>스레드의 Main 함수가 <code>drawPerson()</code> 을 호출하면 <code>startCoroutine</code> 블럭을 만나 하나의 코루틴을 만들어 시작한다. 이제 <code>drawPeson()</code> 은 진입점과 탈출점이 여러개가 되는 자격이 주어진다.</li>
<li>코루틴이 실행되었지만, <code>suspend</code> 키워드를 만나기 전까지는 그다지 특별한 힘이 없다. <code>suspend</code> 로 정의된 함수가 없다면 그냥 마지막 괄호를 만날 때까지 계속 실행된다. 그러나 <code>drawHead()</code> 는 <code>suspend</code> 키워드로 정의된 함수이다. 따라서 <code>drawHead()</code> 부분에서 더 이상 아래 코드를 실행하지 않고 <code>drawPerson()</code>이라는 코루틴 함수를 (잠시) 탈출한다.</li>
<li>메인 스레드가 해당 코루틴을 탈출했다. 그렇다고 스레드가 놀고 있지는 않는다. 우리가 작성한 다른 코드들을 실행할 수도 있고 안드로이드에서는 UI 애니메이션을 처리할 수도 있다. <strong>그러나 Head는 어디선가 계속 그려지고 있다.</strong> drawHead()는 2초가 걸리는 <code>suspend</code> 함수였다. drawHead() 라는 <code>suspend</code> 를 만나 코루틴을 탈출했지만, drawHead() 함수의 기능은 메인 스레드에서 동시성 프로그래밍으로 작동하고 있을 수도 있고, 다른 스레드에서 돌아가고 있을 수도 있다. 그것은 <strong>개발자가 자유롭게 선택할 수 있다.</strong></li>
<li>그렇게 메인 스레드가 다른 코드들을 실행하다가도 <code>drawHead()</code> 가 자신의 역할을 다 끝내면 다시 아까 탈출했던 코루틴 <code>drawPerson()</code>으로 돌아온다. 아까 멈추어놓았던 <code>drawHead()</code> 아래 부분인 <code>drawBody()</code>부터 재개(resume)된다.</li>
</ol>
<p>위의 과정을 통해서 확인할 수 있듯이, 코루틴 함수는 언제든지 나왔다가 다시 들어올 수 있다. 코루틴의 이런 성향은 동시성 프로그래밍과 밀접한 관계가 있다.</p>
<h3 id="동시성-프로그래밍">동시성 프로그래밍</h3>
<p>함수를 중간에 빠져나왔다가, 다른 함수에 진입하고, 다시 원점으로 돌아와 멈추었던 부분부터 다시 시작하는 이 특성은 동시성 프로그래밍을 가능하게 한다.</p>
<p>동시성 프로그래밍의 개념을 잡고가자면, 병행성 프로그래밍과 완전히 다른 개념이다. 예를 들어, 양쪽에 놓여진 두 개의 도화지에 사람 그림을 각자 그린다고 가정해보자.</p>
<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/b5dff5e0-7839-4c61-833e-ccd7eee2180e/Untitled.png" alt="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/b5dff5e0-7839-4c61-833e-ccd7eee2180e/Untitled.png"></p>
<p><strong>동시성 프로그래밍</strong>이란 오른쪽 손에만 펜을 쥐고서 왼쪽 도화지에 사람 일부를 조금 그리고, 오른쪽 도화지에 가서 잠시 또 사람을 그리고, 다시 왼쪽 도화지에 사람을 찔끔 그릭고 … 이러한 행위를 아주 빠르게 반복하는 것이다.</p>
<p>사실 내가 쥔 펜은 한 순간에 한 가지 도화지에만 닿는다. 그러나 이 행위를 멀리서 본다면 마치 동시에 그림이 그려지고 있는 것처럼 보일 것이다. 이러한 개념이 <strong>동시성 프로그래밍</strong>이다.</p>
<p><strong>병행성 프로그래밍</strong>은 이것과 다르다. 병행성은 실제로 양쪽 손에 펜을 하나씩 들고서 왼쪽과 오른쪽에 실제로 그림을 동시에 그리는 것이다. 같은 시간 동안 병행해서 그림을 그리는 것이다.</p>
<p>코루틴은 개념 자체로만 보면 병행성이 아니라 동시성을 지원하는 개념이다. 아래의 코드를 통해 개념을 다시 한 번 이해해보자.</p>
<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4f5f470d-82ae-4053-b5af-8cad39b0b610/Untitled.png" alt="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4f5f470d-82ae-4053-b5af-8cad39b0b610/Untitled.png"></p>
<p>코루틴도 루틴이다. 즉, 스레드가 아니라 일반 서브 루틴과 비슷한 루틴이기 때문에 하나의 스레드에 여러 개가 존재할 수 있다.</p>
<p>위의 코드에서 메인 스레드에 코루틴이 두 개 있다., 하나는 왼쪽 도화지에 그림을 그리는 코드이고, 다른 하나는 오른쪽 도화지에 그림을 그리는 코드이다. 메인 스레드가 실행되면서 먼저, 왼쪽 코루틴인 <code>drawPersonToPaperA()</code> 라는 함수를 만났다고 가정해보자. 해당 함수는 가상 코루틴 빌더인 <strong>startCoroutine { }</strong> 블럭으로 인해 코루틴이 되고, 함수를 중간에 나갔다가 다시 들어올 수 있는 자격이 생긴다. <code>drawPersonToPaperA()</code> 가 호출되어 <code>suspend</code> 함수인 <code>drawHead()</code> 를 만나게 되면 이 코루틴을 잠시 빠져나간다.</p>
<p>왼쪽 코루틴을 빠져나갔지만 그렇다고 메인 스레드가 가만히 놀고 있지는 않는다. 다른 <code>suspend</code> 함수들을 찾거나 resume 되어지는 다른 코드들을 찾는다. 왼쪽 코루틴은 2초 동안 <code>drawHead()</code> 작업을 하게된다. 그러나 delay(2000)는 스레드를 블락시키지 않으므로 다른 일들을 수행할 수 있다.</p>
<p>뿐만 아니라 <code>drawHead()</code> 함수 안에서 다른 스레드를 실행시킨다면 병행적으로도 실행이 가능하다. 왼쪽 코루틴을 빠져나온 스레드가 오른쪽 코루틴을 만나게 되어 또 한번 <code>suspend</code> 함수를 만나게 되면 위에서 도화지 그림을 설명한 것과 같은 현상이 일어난다. 오른손에 펜을 쥐고 왼쪽과 오른쪽 도화지를 아주 빠르게 왔다 갔다 하면서 그림을 그리는 것 같은 셈이다. <strong>이렇게 코루틴을 사용하여 스레드 하나에서 동시성 프로그래밍이 가능하다.</strong></p>
<p>코루틴을 생성해서 동시성 프로그래밍을 하는 것은 스레드를 사용해서 동시성 프로그래밍을 하는 것과 차원이 다른 효율성을 제공한다. 위에서 말한 동작을 스레드 두 개를 만들어 실행한다고 가정해보자.</p>
<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e9a2a45c-7482-46e3-9767-7a1fa358eb0e/Untitled.png" alt="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e9a2a45c-7482-46e3-9767-7a1fa358eb0e/Untitled.png"></p>
<p>왼쪽 스레드는 왼쪽 도화지에, 오른쪽 스레드는 오른쪽 도화지에 그림을 그리는 코드이다. 그러나 CPU는 단 한 개뿐이다. 따라서 왼쪽에 조금, 오른쪽에 조금을 반복하기 위해서는 CPU가 매번 스레드를 점유했다가 반환하고, 새로운 스레드를 점유했다가 반환하고를 반복해야 한다. 이를 <strong>컨텍스트 스위칭</strong>이라고 한다. 하나의 스레드에서 단순히 함수를 왔다 갔다 하는 것과는 다르게 꽤 비용이 드는 작업이다.</p>
<p>아래는 ‘함수형 코틀린’ 책에 나오는 구문이다.</p>
<p><strong><em>2,000개 미만의 스레드에는 1.5GB 이상의 메모리가 필요하다. 100만 개의 코루틴은 700MB 미만의 메모리가 필요하다. 결론은 코루틴은 매우, 매우 가볍다는 것이다. - 마리오 아리아스</em></strong></p>
<h3 id="비동기-처리가-수월해진다">비동기 처리가 수월해진다.</h3>
<p>위에서 설명한 코틀린의 능력으로 비동기 처리가 굉장히 쉬워진다. 심지어는 ‘비동기 처리인가?’ 싶을 정도로 읽기 쉽고 작성하기도 쉬운 코드를 볼 수 있다.</p>
<p>아래의 예시를 통해 이해해보자.</p>
<ol>
<li>8시 기상</li>
<li>샤워하기</li>
<li>옷 입기</li>
<li>출발하기</li>
<li>회사 도착하기</li>
<li>일하기</li>
</ol>
<p>위의 시나리오는 꼭 순서대로 이뤄져야 하는 작업이다. 기상하지 않았는데, 옷을 입을 수는 없고, 옷을 입지 않았는데, 출근을 할 수도 없다. 또한, 각 과정은 시간이 오래 걸리는 작업이라고 가정하자. 예를 들면, 네트워크 처리 같은?</p>
<p><strong>[Callback]</strong></p>
<p>가장 먼저 Callback을 사용해 구현해보자.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">goCompany</span><span class="params">(person: <span class="type">Person</span>)</span></span>&#123;</span><br><span class="line">	<span class="keyword">val</span> 잠든승우 = person</span><br><span class="line">	</span><br><span class="line">	wakeUp(잠든승우) &#123; 비몽사몽한승우 -&gt;</span><br><span class="line">		takeShower(비동사몽한승우) &#123; 깔끔한승우 -&gt;</span><br><span class="line">			putOnClothes(깔끔한승우) &#123; 옷입은승우 -&gt;</span><br><span class="line">				takeBus(옷입은승우) &#123; 버스를탄승우 -&gt;</span><br><span class="line">					<span class="keyword">val</span> 출근한승우 = finish(버스를탄승우)</span><br><span class="line">					출근한승우.doWork()</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>콜백으로 비동기 처리를 구현했을 때, 흔히 겪을 수 있는 콜백 지옥이다. 심지어 에러 처리도 하지 않은 코드인데 벌써 가독성이 떨어진다. 비동기 처리를 위한 다양한 방법론이 나오기 전에는 대부분 이런 방식으로 처리했다.</p>
<p><strong>[RxKotlin]</strong></p>
<p>안드로이드 프로그래밍에서 거의 필수적이라고 할 수 있는 RxJava, RxKotlin으로 짜여진 동일한 코드를 보자.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">goCompany</span><span class="params">(person: <span class="type">Person</span>)</span></span>&#123;</span><br><span class="line">	<span class="keyword">val</span> 잠든승우 = person</span><br><span class="line">	</span><br><span class="line">	Observable</span><br><span class="line">			.just(잠든승우)</span><br><span class="line">			.observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">			.subscribeOn(Schedulers.io())</span><br><span class="line">			.flatMap &#123; 잠든승우 -&gt; wakeUp(잠든승우) &#125;</span><br><span class="line">			.flatMap &#123; 비몽사몽한승우 -&gt; takeShower(비몽사몽한승우) &#125;</span><br><span class="line">			.flatMap &#123; 깔끔한승우 -&gt; putOnClothes(깔끔한승우) &#125;</span><br><span class="line">			.flatMap &#123; 옷입은승우 -&gt; takeBus(옷입은승우) &#125;</span><br><span class="line">			.flatMap &#123; 버스를탄승우 -&gt; finish(버스를탄승우) &#125;</span><br><span class="line">			.subscribe(&#123; 출근한승우 -&gt; </span><br><span class="line">				출근한승우.doWork()</span><br><span class="line">			&#125;,&#123; </span><br><span class="line">				handleError()</span><br><span class="line">			&#125;)</span><br></pre></td></tr></table></figure>
<p>콜백 코드보다 훨씬 가독성이 좋다. 왜 코드가 잘 읽히는 것일까?</p>
<p><code>wakeUp()</code>, <code>takeShower()</code>, <code>putOnClothes()</code> 등의 함수들이 보통 사람이 생각하는 것처럼 순차적으로 보이기 때문인 것 같다. 즉, 각 과정의 함수들이 동일한 depth를 유지하며 동기적인 코드처럼 보이기 때문에 훨씬 보기가 편해졌다.</p>
<p>하지만, Rx를 모르는 사람이 코드를 읽게 된다면 어떻게 될까? Observable, just, flatMap 등이 무엇인지 이해해야 하고, 코드를 보면 어지러울 수도 있다. 뿐만 아니라  Rx가 제공하는 다양한 연산자들이 상당히 많고 개념이 어렵기 때문에 학습 곡선이 높다.</p>
<p>그럼에도 Rx는 아는 사람끼리는 너무나도 좋은 도구인 것은 확실하며 높은 학습 곡선만큼 효율성도 크다.</p>
<p><strong>[Kotlin + Coroutine]</strong></p>
<p>이번에는 Kotlin + Coroutine 조합을 해보자.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">suspend <span class="function"><span class="keyword">fun</span> <span class="title">goCompany</span><span class="params">(person: <span class="type">Person</span>)</span></span>&#123;</span><br><span class="line">	<span class="keyword">val</span> 잠든승우 = person</span><br><span class="line"></span><br><span class="line">	<span class="keyword">try</span> &#123; </span><br><span class="line">		<span class="keyword">val</span> 비몽사몽한승우 = wakeUp(잠든승우)</span><br><span class="line">		<span class="keyword">val</span> 깔끔한승우 = takeShower(비몽사몽한승우)</span><br><span class="line">		<span class="keyword">val</span> 옷입은승우 = putOnClothes(깔끔한승우)</span><br><span class="line">		<span class="keyword">val</span> 버스를탄승우 = takeBus(옷입은승우)</span><br><span class="line">		<span class="keyword">val</span> 출근한승우 = finish(버스를탄승우)</span><br><span class="line"></span><br><span class="line">		출근한승우.doWork()</span><br><span class="line">	&#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">		handleError()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>코드를 보면 &quot;이게 비동기 처리를 하는 코드가 맞나?&quot;라는 생각이 들 수 있다. 그러나 분명히 비동기 코드이다. 안에서 호출되는 각 함수들은 분명히 네트워크를 타고 실행되어야 하는 시간이 오래 걸리는 작업이고, 언제 끝날지 모르는 비동기 작업들이지만 각자 함수들의 순서는 정확히 지켜진다.</p>
<p><code>takeShower()</code> 함수는 <code>wakeUp()</code> 함수가 끝나야만 실행되고, <code>putOnClothes()</code> 함수는 <code>takeShower()</code> 함수가 끝나야만 실행된다.</p>
<p>이러한 동작이 가능한 이유는 <code>goCompany()</code> 라는 함수가 코루틴이기에 <code>wakeUp()</code> 을 만나면 <code>wakeUp()</code> 함수를 실행함과 동시에 잠시 <code>goCompany()</code>를 빠져나간다. 그러다가 <code>wakeUp()</code> 이 자신의 일을 끝마치면 다시 <code>goCompany()</code> 로 돌아올 수 있기 때문이다. <strong>이게 코루틴으로 비동기 처리를 할 때, 생기는 장점이다.</strong></p>
<h3 id="결론">결론</h3>
<p>비동기 처리에 있어 Rx는 매우 훌륭한 도구이며 기술이다. 하지만, 최근의 동향을 보면 Rx → Coroutine을 부정할 수 없을 것 같다. 그래서 필자도 코루틴을 공부하려는 것이고 아마 공부해서 적용한 뒤에는 Rx보다는 코루틴을 선호할 수도 있을 것 같다.</p>
<p>Rx를 사용하는 가장 주된 이유 중 하나는 비동기 처리인데, 결국 Rx도 비동기 처리를 쉽게 하기 위한 하나의 방법이라고 볼 수 있다. 궁극적으로 비동기 처리를 위해 여러가지 헬퍼 코드들이 덕지 덕지 붙게 된다.</p>
<p>반면, 코루틴은 비동기 처리를 위해 그런 것들을 거부하는 것처럼 보인다. 마치 “왜 비동기 처리 때문에 고생하니? 그냥 동기처럼 짜면돼!” 라고 말하는 것 같다.</p>
<h3 id="bonus">Bonus</h3>
<p>코루틴의 개념은 알겠는데, 어떻게 함수를 중간에 왔다 갔다 할 수 있는지에 대한 궁금증이 있을 것 같다. 이걸 가능하게 하는 키워드는 <a href="http://dogfeet.github.io/articles/2012/by-example-continuation-passing-style-in-javascript.html" target="_blank" rel="noopener">CPS(Continuatino Passing Style)</a>이다.</p>
<h3 id="reference">Reference</h3>
<ul>
<li><a href="https://wooooooak.github.io/kotlin/2019/08/25/%EC%BD%94%ED%8B%80%EB%A6%B0-%EC%BD%94%EB%A3%A8%ED%8B%B4-%EA%B0%9C%EB%85%90-%EC%9D%B5%ED%9E%88%EA%B8%B0/" target="_blank" rel="noopener">쾌락코딩</a></li>
</ul>

        </div>
        
        <footer class="article-footer">
            <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
(adsbygoogle = window.adsbygoogle || []).push({
     google_ad_client: "ca-pub-9725307592233286",
     enable_page_level_ads: true
});
</script>
            



    <a data-url="https://woovictory.github.io/2020/07/07/Kotlin-Coroutine-1/" data-id="ckd6xgt6y018t51pq1tybxpy7" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
</article>

    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>



                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>follow:</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="facebook" href="https://www.facebook.com/WooVictory" target="_blank" rel="noopener">
                        <i class="icon fa fa-facebook"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/WooVictory" target="_blank" rel="noopener">
                        <i class="icon fa fa-github"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="linkedin" href="https://www.linkedin.com/in/seungwoo-lee-590844177" target="_blank" rel="noopener">
                        <i class="icon fa fa-linkedin"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2020/07/08/Android-SingleLiveEventToEventWrapper/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption">newer</strong>
        <p class="article-nav-title">
        
            [Android] MVVM UI Event Wrapper
        
        </p>
        <i class="icon fa fa-chevron-right" id="icon-chevron-right"></i>
    </a>
    
    
        <a href="/2020/07/06/CleanCode-3/" id="article-nav-older" class="article-nav-link-wrap">
        <strong class="article-nav-caption">older</strong>
        <p class="article-nav-title">[CleanCode] 3장. 함수</p>
        <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>
        </a>
    
</nav>

    
    <div class="widgets-container">
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
(adsbygoogle = window.adsbygoogle || []).push({
     google_ad_client: "ca-pub-9725307592233286",
     enable_page_level_ads: true
});
</script>
        
            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">categories</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">79</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Book/">Book</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Book/CleanCode/">CleanCode</a><span class="category-list-count">4</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Design-Pattern/">Design Pattern</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ETC/">ETC</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Inno-SOPT/">Inno_SOPT</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">39</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kotlin/">Kotlin</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Node-js/">Node.js</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Operation-System/">Operation System</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/RxJava/">RxJava</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/algorithm/">algorithm</a><span class="category-list-count">51</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/algorithm/BOJ/">BOJ</a><span class="category-list-count">49</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/algorithm/Programmers/">Programmers</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/개발-상식/">개발 상식</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/네트워크/">네트워크</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/데이터베이스/">데이터베이스</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/삼성-기출/">삼성 기출</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/알고리즘/">알고리즘</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/자료구조/">자료구조</a><span class="category-list-count">10</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap">
        <h3 class="widget-title">recents</h3>
        <div class="widget">
            <ul id="recent-post" class="no-thumbnail">
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/ETC/">ETC</a></p>
                            <p class="item-title"><a href="/2020/07/29/Memo-Privacy/" class="title">[Memo] 개인정보 처리 방침</a></p>
                            <p class="item-date"><time datetime="2020-07-29T05:11:19.000Z" itemprop="datePublished">2020-07-29</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Book/">Book</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/categories/Book/CleanCode/">CleanCode</a></p>
                            <p class="item-title"><a href="/2020/07/21/CleanCode4/" class="title">[CleanCode] 4장. 주석</a></p>
                            <p class="item-date"><time datetime="2020-07-21T14:40:14.000Z" itemprop="datePublished">2020-07-21</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Android/">Android</a></p>
                            <p class="item-title"><a href="/2020/07/08/Android-SingleLiveEventToEventWrapper/" class="title">[Android] MVVM UI Event Wrapper</a></p>
                            <p class="item-date"><time datetime="2020-07-08T01:34:10.000Z" itemprop="datePublished">2020-07-08</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Kotlin/">Kotlin</a></p>
                            <p class="item-title"><a href="/2020/07/07/Kotlin-Coroutine-1/" class="title">[Kotlin] Coroutine 이해하기</a></p>
                            <p class="item-date"><time datetime="2020-07-07T02:05:54.000Z" itemprop="datePublished">2020-07-07</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Book/">Book</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/categories/Book/CleanCode/">CleanCode</a></p>
                            <p class="item-title"><a href="/2020/07/06/CleanCode-3/" class="title">[CleanCode] 3장. 함수</a></p>
                            <p class="item-date"><time datetime="2020-07-06T07:57:43.000Z" itemprop="datePublished">2020-07-06</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
        
    </div>
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
(adsbygoogle = window.adsbygoogle || []).push({
     google_ad_client: "ca-pub-9725307592233286",
     enable_page_level_ads: true
});
</script>
</aside>

                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo"></a>
                </h1>
                <p>&copy; 2020 VictoryWoo</p>
                <p>Powered by <a href="//hexo.io/" target="_blank">Hexo</a>. Theme by <a href="//github.com/ppoffice" target="_blank">PPOffice</a></p>
            </div>
            <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
(adsbygoogle = window.adsbygoogle || []).push({
     google_ad_client: "ca-pub-9725307592233286",
     enable_page_level_ads: true
});
</script>
            <div class="footer-plugins">
              
    


            </div>
        </div>
    </div>
</footer>

        
    
    <script>
    var disqus_shortname = 'hexo-theme-hueman';
    
    
    var disqus_url = 'https://woovictory.github.io/2020/07/07/Kotlin-Coroutine-1/';
    
    (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>
