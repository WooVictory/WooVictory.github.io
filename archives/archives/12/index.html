
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="VictoryWoo">
    <title>Archives - VictoryWoo</title>
    <meta name="author" content="VictoryWoo">
    
    
    
    <script type="application/ld+json">{}</script>
    <meta property="og:type" content="blog">
<meta property="og:title" content="VictoryWoo">
<meta property="og:url" content="https://woovictory.github.io/archives/archives/12/index.html">
<meta property="og:site_name" content="VictoryWoo">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="VictoryWoo">
    
    
        
    
    
        <meta property="og:image" content="https://woovictory.github.io/assets/images/Victory.jpeg"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/all.css">
    <link rel="stylesheet" href="/assets/css/jquery.fancybox.css">
    <link rel="stylesheet" href="/assets/css/thumbs.css">
    <link rel="stylesheet" href="/assets/css/tranquilpeak.css">
    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-125410253-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-125410253-1');
    </script>


    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="2">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/ "
            aria-label=""
        >
            VictoryWoo
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/Victory.jpeg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="2">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="Read more about the author"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/Victory.jpeg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">VictoryWoo</h4>
                
                    <h5 class="sidebar-profile-bio"><p>기록을 통해 사람들과 공유하는 것을 좋아합니다.</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="Search"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Search</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/WooVictory"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.facebook.com/WooVictory"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Facebook"
                        >
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/profile/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/jhsw0375@gmail.com"
                            
                            rel="noopener"
                            title="Mail"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="2"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2019/02/07/Java-Why-is-needed-primitive-type/"
                            aria-label=": 18일차 [자바] Primitive Type"
                        >
                            18일차 [자바] Primitive Type
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2019-02-07T15:13:10+09:00">
	
		    Feb 07, 2019
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Java/">Java</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>자바로 프로젝트를 진행하고 있다. 하지만, 자바에 대한 개념이 약해서 예전에 정리했던 자료들을 보면서 익히고 있고 프로젝트를 하면서 어느정도 손에 익었다고 생각이 된다. 아직까지는 자바가 강세이긴 한 것 같다…ㅜ 조금 더 자바에 대해 공부하기 위해 <strong>이펙티브 자바</strong>책도 사서 공부해봐야겠다.</p>
<p>그럼 이제 본론으로 들어가서 자바에서는 자료형을 크게 두 가지로 나눌 수 있다. 기본 자료형(Primitive Type)과 참조 자료형(Reference Type. 여기서는 Wrapper Class)이 존재한다.</p>
<ul>
<li>기본 자료형 : char, byte, short, int 등등</li>
<li>참조 자료형 : Integer, Byte 등등</li>
</ul>
<p>그럼 자바에서 Primitive Type과 NonPrimitve Type을 만들어 놓은 이유는 무엇일까??</p>
<p><strong>효율성을 위해서</strong>라고 한다. Primitive Type의 변수는 값을 직접 포함한다. 참조형 타입의 변수는 메모리 내의 다른 곳에 저장된 객체를 참조하는 참조이다.</p>
<p>Wrapper Type의 값을 사용해야 할 때마다 JVM은 객체를 메모리에서 찾아 값을 가져와야 한다. 반면에 값이 포함된 객체에 대한 참조 대신 변수 자체에 값이 포함되어 있는 Primitive Type에는 메모리에 접근할 필요가 없다.</p>
<p>객체인 Wrapper는 힙 영역에 저장된다. Primitive는 단지 &quot;값&quot;이기 때문에 스택 영역에 들어간다. 힙의 래핑된 Primitive의 경우 스택에 있는 값과 Wrapper 객체에 대한 참조가 둘 다 필요하기 때문에 더 효율적이다.</p>
<p>흠… 아직까지 무슨 말인지 모르겠다… 위에서 찾아본 바로는 효율성을 위해서 존재하는 것이 가장 이해가 간다.</p>
<p>또 다른 의견으로는 메모리 및 CPU 처리 측면에서 Primitive Type이 더 가볍고 효율적이라는 의견도 존재한다.</p>
<p>+추가 의견으로는 객체 생성, 힙 할당이 너무 비싸고 성능상의 불이익이 있기 때문이라고 한다. int, float 등의 Primitye Data Type이 가장 많이 사용되므로 Object로 만드는 것은 엄청난 성능 저하일 것이다.</p>
<h2 id="참고-사이트">참고 사이트</h2>
<ul>
<li><a href="https://stackoverflow.com/questions/14477743/why-are-there-primitive-datatype-in-java" target="_blank" rel="noopener">why are there Primitive datatype in Java? [duplicate]</a></li>
<li><a href="https://stackoverflow.com/questions/2063556/when-we-have-wrappers-classes-why-primitives-are-supported?noredirect=1&amp;lq=1" target="_blank" rel="noopener">When we have wrappers classes, why primitives are supported?</a></li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2019/02/07/Java-Why-is-needed-primitive-type/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2019/02/07/Design-Pattern-Factory-Pattern/"
                            aria-label=": 18일차 [디자인 패턴] 팩토리 패턴"
                        >
                            18일차 [디자인 패턴] 팩토리 패턴
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2019-02-07T11:41:13+09:00">
	
		    Feb 07, 2019
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Design-Pattern/">Design Pattern</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>신입 개발자를 위한 <a href="https://github.com/WooVictory/Ready-For-Tech-Interview" target="_blank" rel="noopener">Repository</a>를 만들었습니다. 공부한 내용을 정리 중이니 도움이 되신다면 와서 Star를 눌러주시면 감사하겠습니다.</p>
<p>안드로이드에서 <strong>Fragment</strong>를 생성할 때 클래스의 인스턴스 즉, 객체를 만드는 상황에서 new를 통해서 바로 생성하지 않고 newInstatnce()라는 메소드를 통해서 만든다. 이와 관련된 이유는 이전 포스팅을 참고하도록 하고 이런 방식을 팩토리 메소드?를 사용한다고 한다. 이것을 보고 팩토리 패턴에 대해 찾아보기로 하였다.</p>
<h2 id="팩토리-패턴factory-pattern">팩토리 패턴(Factory Pattern)</h2>
<ul>
<li>모든 팩토리 패턴에서는 객체 생성을 캡슐화한다.</li>
<li>팩토리 메소드 패턴과 추상 팩토리 패턴이 존재한다.</li>
<li><strong>팩토리 메소드 패턴</strong> : 객체를 생성하기 위한 인터페이스를 정의하는데, 어떤 클래스의 인스턴스를 만들지는 서브 클래스에서 결정한다.</li>
<li><strong>추상 팩토리 패턴</strong> : 인터페이스를 이용하여 서로 연관된, 또는 의존하는 객체를 구상 클래스를 지정하지 않고도 생성할 수 있다. 추상 팩토리 패턴에는 팩토리 메소드 패턴이 포함될 수 있다.</li>
<li>디자인 원칙 중 '추상화된 것에 의존하도록 만들어라. 구상 클래스에 의존하지 않도록 만든다.'에 기인한 패턴이다.</li>
</ul>
<p>팩토리 패턴의 핵심은 <code>클래스의 인스턴스를 만드는 것을 서브클래스에서 결정하도록 한다는 것이다.</code> 즉, new 키워드를 사용하는 부분을 서브클래스에 위임함으로서 객체 생성을 캡슐화하고 구상 클래스에 대한 의존성이 줄어든다는 이점을 얻을 수 있다.</p>
<p>특히 구상 클래스에 대한 의존성이 줄어드는 것은 <strong>의존성 뒤집기 원칙</strong>(Dependency Inversion Principle:DI)에 기인하는데, DI는 자바 진영에서 널리 쓰이고 있는 Spring 프레임워크의 핵심 개념 중 하나이다. 싱글톤 패턴과 더불어 가장 유명하고 널리 쓰이는 디자인 패턴 중 하나라고 할 수 있다.</p>
<h2 id="팩토리-메소드-패턴">팩토리 메소드 패턴</h2>
<p>위에서 언급했듯이, 객체를 생성하기 위한 인터페이스를 정의하는데, 어떤 클래스의 인스턴스를 만들지는 서브 클래스에서 결정하도록 하는 것이다. <strong>팩토리 메소드 패턴은 팩토리 메소드는 객체를 생성해서 반환하는 것을 말한다. 즉, 결과값이 객체인 것이다.</strong></p>
<p><strong>이점은 뭘까?</strong><br>
클래스의 변경사항이 생겼을 때 얼마나 다른 클래스에게도 영향을 줄 것인가가 <code>결합도</code>이다. 팩토리 메소드 패턴은 직저버 사용하는 객체를 생성하지 않고 팩토리 메소드 클래스를 통해 객체를 대신 새애성하고 그 객체를 반환 받아 사용하기 때문에 효율적인 코드 제어를 할 수 있을 뿐더러 결합도를 낮춰 유지보수가 용이하다.</p>
<p><strong>예시</strong><br>
아이언맨 수트에 빗대어 예제를 설명하려고 한다. 아이언맨의 각 수트들은 각각의 고유한 기능들을 가지고 있기 때문에 특정 상황에 맞춰서 토니 스타크가 착용하는 수트도 달라지게 된다.(너무 간지…ㅎ) 우주 탐사를 할 때에는 스페이스 아머, 심해 탐사 시에는 하이드로 아머, 그리고 시네마틱 유니버스에서 나왔던 헐크버스터 등을 예로 들 수 있다.</p>
<p>위와 같이 특정 상황을 입력으로 보고 입력에 따라 다른 수트 클래스를 만들어야 하는 상황을 코드로 표현하면 아래와 같다.(사실 코드로 표현하지 않아도 된다. 하지만, 나는 컴공이니까…!)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Suit suit = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span>(type)&#123;</span><br><span class="line">    <span class="keyword">case</span>(<span class="string">"space"</span>):</span><br><span class="line">        suit = <span class="keyword">new</span> SpaceSuit();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span>(<span class="string">"hydro"</span>):</span><br><span class="line">        suit = <span class="keyword">new</span> HydroSuit();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span>(<span class="string">"stealth"</span>):</span><br><span class="line">        suit = <span class="keyword">new</span> StealthSuit();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        suit = <span class="keyword">new</span> CombatSuit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 각 상황에 맞게 수트를 생성할 수 있게 되었고, 아이언맨도 활약을 할 수 있게 되었다. 하지만, 위와 같이 코드를 작성하게 되면 <strong>변경이나 확장할 요소가 생길 시 매번 코드를 추가, 제거</strong>해주어야 한다는 문제가 발생한다. 이로 인해 아이언맨도 활약할 시간이 지체된다.</p>
<p>위의 문제는 <strong>객체 인스턴스를 생성하는(new 키워드를 사용하는) 부분을 별도의 인터페이스로 분리</strong>하면 해결할 수 있다. 이렇게 <strong>생성자를 별도의 인터페이스로 분리하여 객체를 만들어내는 공장(factory)으로 이용하는 것</strong>이 <code>팩토리 메소드 패턴</code>이다.</p>
<ul>
<li>이제 위 코드에서 인스턴스를 생성하는 부분을 인터페이스로 분리해보자.</li>
</ul>
<img src="/img/FactoryMethodPattern.png" width="600" height="200">
<center>UML</center>
<ul>
<li>각가의 suit 클래스들은 Suit 추상 클래스를 상속받아 getName() 메소드를 구현하고 SuiitFactory 추상 클래스를 상속받은 TypeSuitFactory에서는 type별로 수트 인스턴스를 생성하도록 하는 createSuit 메소드를 구현하도록 한다.</li>
</ul>
<ul>
<li>Suit 추상 클래스</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Suit 추상 클래스</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Suit</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">getName</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Suit 추상 클래스를 구현한 각각의 수트 클래스들</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SpaceSuit</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpaceSuit</span> <span class="keyword">extends</span> <span class="title">Suit</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"SpaceSuit"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// HydroSuit</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HydroSuit</span> <span class="keyword">extends</span> <span class="title">Suit</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"HydroSuit"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// StealthSuit</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StealthSuit</span> <span class="keyword">extends</span> <span class="title">Suit</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"StealthSuit"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CombatSuit</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CombatSuit</span> <span class="keyword">extends</span> <span class="title">Suit</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"CombatSuit"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Suit 팩토리 추상 클래스</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">SuitFactory</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Suit <span class="title">createSuit</span><span class="params">(String type)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Suit 팩토리 추상 클래스를 구현한 Suit 팩토리 구현 클래스</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TypeSuitFactory</span> <span class="keyword">extends</span> <span class="title">SuiFactory</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">createSuit</span><span class="params">(String type)</span></span>&#123;</span><br><span class="line">        Suit suit = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span>(type)&#123;</span><br><span class="line">            <span class="keyword">case</span>(<span class="string">"space"</span>):</span><br><span class="line">                suit = <span class="keyword">new</span> SpaceSuit();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span>(<span class="string">"hydro"</span>):</span><br><span class="line">                suit = <span class="keyword">new</span> HydroSuit();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span>(<span class="string">"stealth"</span>):</span><br><span class="line">                suit = <span class="keyword">new</span> StealthSuit();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                suit = <span class="keyword">new</span> CombatSuit();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> suit;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Test를 해보자.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">    TypeSuitFactory typeSuitFactory = <span class="keyword">new</span> TypeSuitFactory();</span><br><span class="line"></span><br><span class="line">    Suit suit1 = typeSuitFactory.createSuit(<span class="string">"stealth"</span>);</span><br><span class="line">    Suit suit2 = typeSuitFactory.createSuit(<span class="string">"space"</span>);</span><br><span class="line">    Suit suit1 = typeSuitFactory.createSuit(<span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(suit1.getName());</span><br><span class="line">    System.out.println(suit2.getName());</span><br><span class="line">    System.out.println(suit3.getName());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">결과</span></span><br><span class="line"><span class="comment">StealthSuit</span></span><br><span class="line"><span class="comment">SpaceSuit</span></span><br><span class="line"><span class="comment">CombatSuit</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>인스턴스 생성을 서브 클래스로 위임한 결과이다. 최종 메인 메소드에서는 <strong>new 키워드를 사용하여 인스턴스를 생성한 부분이 없는 것을 확인</strong>할 수 있다. 이를 통해 <strong>메인 프로그램에서는 어떤 객체가 생성되었는지 신경 쓸 필요 없이 반환된 객체만 사용</strong>하면 되고 슈트 클래스에서 변경이 발생해도 <strong>메인 프로그램이 변경되는 것은 최소화</strong>할 수 있다.</p>
<h2 id="추상-팩토리-패턴">추상 팩토리 패턴</h2>
<p>다음은 추상 팩토리 패턴에 관한 예시이다. 위의 정의에서 추상 팩토리 패턴은 인터페이스를 이용하여 서로 연관된, 또는 의존하는 객체를 구상 클래스를 지정하지 않고도 생성할 수 있다고했다. <strong>즉, 연관된 서브 클래스를 그룹화할 수 있고 이것은 이 그룹을 자유롭게 교체할 수 있는 패턴</strong>이라고 할 수 있다.</p>
<img src="/img/AbstractFactoryPattern.png" width="600" height="200">
<center>UML</center>
<p>SuitAbstractFactory 인터페이스를 작성하고 이를 상속받아 각 슈트를 생성하는 팩토리 클래스를 구성한다. 그리고 SuitFactory에서는 이 팩토를 파라미터로 받아 최종적으로 생성된 슈트 객체를 반환하게 된다.</p>
<ul>
<li>추상 팩토리 인터페이스</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SuitAbstractFactory</span></span>&#123;</span><br><span class="line">    <span class="comment">// Suit는 위에서 정의한 추상 클래스</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Suit <span class="title">CreateSuit</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Suit 팩토리 클래스</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CombatFactory</span> <span class="keyword">implements</span> <span class="title">SuitAbstractFactory</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Suit <span class="title">createSuit</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CombatSuit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Space</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpaceFactory</span> <span class="keyword">implements</span> <span class="title">SuitAbstractFactory</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Suit <span class="title">createSuit</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SpaceSuit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Stealth</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StealthFactory</span> <span class="keyword">implements</span> <span class="title">SuitAbstractFactory</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Suit <span class="title">createSuit</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> StealthSuit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 생략</span></span><br></pre></td></tr></table></figure>
<ul>
<li>팩토리 클래스를 파라미터로 받는 구현 클래스</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SuitFactory</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Suit <span class="title">getSuit</span><span class="params">(SuitAbstractFactory suitAbstractFactory)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> suitAbstractFactory.createSuit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Main에서 구현</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">    Suit suit1 = SuitFactory.getSuit(<span class="keyword">new</span> CombatFactory());</span><br><span class="line">    Suit suit2 = SuitFactory.getSuit(<span class="keyword">new</span> SpaceFactory());</span><br><span class="line">    Suit suit3 = SuitFactory.getSuit(<span class="keyword">new</span> StealthFactory());</span><br><span class="line"></span><br><span class="line">    System.out.println(suit1.getName());</span><br><span class="line">    System.out.println(suit2.getName());</span><br><span class="line">    System.out.println(suit3.getName());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">결과</span></span><br><span class="line"><span class="comment">CombatSuit</span></span><br><span class="line"><span class="comment">SpaceSuit</span></span><br><span class="line"><span class="comment">StealthSuit</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>위 결과 코드와 같이 슈트별 팩토리 클래스를 파라미터로 넘겨 각 슈트 객체를 반환 받아 사용할 수 있다. 이렇게 되면 <strong>팩토리 클래스 교체만으로 조금 더 유연하게 기능의 수정, 확장에 대처</strong>할 수 있게 된다. 코드 상으로는 if-else 구문을 제거하여 조금 더 깔끔하게 코드를 구성할 수 있다.</p>
<p><strong>나의 이해</strong></p>
<p>CombatFactory는 SuitAbstractFactory 인터페이스를 구현하고 있다. 각 수트 Factory 클래스는 전부 SuitAbstractFactory 인터페이스를 구현하고 있는 셈이다. 결국 <strong>부모</strong>는 SuitAbstractFactory가 되고, <strong>자식</strong>은  각 Suit Factory들이 된다.</p>
<p><code>SuitFactory.getSuit()</code> 문장을 보면 getSuit() 함수의 파라미터로 SuitAbstractFactory 타입의 클래스를 넘길 수 있다. 하지만, 잘 생각해보면 SuitAbstractFactory를 구현한 자식 클래스도 넘길 수 있다. 코드처럼 new CombatFactory()를 넘기면 부모 클래스를 구현한 자식인 CombatFactory는 부모 타입으로 전달될 수 있다. 그리고 <code>createSuit()</code> 메소드를 호출하게 되는데 이는 파라미터로 전달받은 객체의 createSuit() 메소드를 호출하게 된다. 우리가 파라미터로 전달받은 객체는 CombatFactory이다. 그러므로 CombarFactory의 createSuit() 메소드를 호출하고 <code>new CombatSuit()</code>를 통해 객체를 생성하게 된다. 결국 CombatSuit 클래스의 객체를 얻을 수 있으며 getName() 함수를 통해 확인하면 <strong>CombatSuit</strong>가 출력되는 걸 확인할 수 있다.</p>
<h2 id="참고-사이트">참고 사이트</h2>
<ul>
<li><a href="https://jdm.kr/blog/180" target="_blank" rel="noopener">팩토리 메소드 패턴(Factory Method Pattern)</a></li>
<li><a href="http://friday.fun25.co.kr/blog/?p=280" target="_blank" rel="noopener">디자인패턴:팩토리 패턴(FACTORY PATTERN)</a></li>
<li><a href="https://limkydev.tistory.com/83?category=957882" target="_blank" rel="noopener">[Design_Pattern] 팩토리 메서드 패턴(Factory Method Pattern)</a></li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2019/02/07/Design-Pattern-Factory-Pattern/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2019/02/06/Android-Why-is-Need-default-constructor-of-fragment/"
                            aria-label=": 17일차 [안드로이드] 프래그먼트에 대해"
                        >
                            17일차 [안드로이드] 프래그먼트에 대해
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2019-02-06T22:21:09+09:00">
	
		    Feb 06, 2019
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Android/">Android</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>안드로이드에서 <strong>Fragment</strong>는 거의 필수적으로 사용된다고 볼 수 있다. Activity 위에서 부분 화면을 나타내는데 Fragment는 아주 효율적으로 사용할 수 있다. 그렇다면 <strong>Fragment</strong>를 어떻게 만들어서 구현을 하는가에 대해서 생각해 볼 필요가 있을 것이다.</p>
<ul>
<li>일반적으로 나는 <strong>Fragment</strong>를 사용할 때 아래와 같이 코드를 작성하였다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup viewGroup, Bundle savedInstanceState)</span></span>&#123;</span><br><span class="line">        View view = inflater.from(viewGroup.context).inflate(R.layout.fragment_my.xml, viewGroup, <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> view</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>위의 코드가 내가 지금까지 <strong>Fragment</strong>를 사용할 때 작성해왔던 코드이다. 하지만, 최근에 들어서 코드 리뷰를 통해서 이렇게 <strong>Fragment</strong>를 작성하는게 맞을까란 이야기를 들었다. 보통 관용적으로 <code>newInstance()</code>라는 함수를 사용해서 만들게 되는데 이것과 <code>기본 생성자</code>를 키워드로 찾아보라고 하셨다.</li>
</ul>
<h2 id="그래서-어떻게">그래서 어떻게?</h2>
<p>그래서 어떻게?라니 바로 키워드를 잡고 찾아보기 시작했다. 먼저, <code>newInstance()</code>라는 키워드를 가지고 찾아보니 생성자에 관한 이야기도 함께 설명하는 글을 꽤 찾을 수 있었다.</p>
<p><strong>Fragment</strong>를 만들 때는 생성자를 오버로딩 하지 않고 생성 시 필요한 파라미터가 생기면 <code>Bundle</code> 객체에 담아서 setArgument() 함수를 호출하는 방식을 사용하는 것이 일반적이다. 왜냐하면 안드로이드에 의해서 <strong>Fragment</strong>가 복원될 때는 Fragment의 기본 생성자를 호출하기 때문에 오버로딩된 생성자의 호출이 보장되지 않는다.</p>
<p>그렇기 때문에 아래와 같은 코드를 사용하며 이 코드는 관용적으로 Fragment를 생성할 때 사용하는 코드가 되었다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DetailsFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new instance of DetailsFragment, initialized to</span></span><br><span class="line"><span class="comment">     * show the text at 'index'.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DetailsFragment <span class="title">newInstance</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        DetailsFragment f = <span class="keyword">new</span> DetailsFragment();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Supply index input as an argument.</span></span><br><span class="line">        Bundle args = <span class="keyword">new</span> Bundle();</span><br><span class="line">        args.putInt(<span class="string">"index"</span>, index);</span><br><span class="line">        f.setArguments(args);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> f;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getShownIndex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getArguments().getInt(<span class="string">"index"</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup container,</span></span></span><br><span class="line"><span class="function"><span class="params">            Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        TextView textView = <span class="keyword">new</span> TextView(getActivity());</span><br><span class="line">        text.setText(String.valueOf(getShownIndex()));</span><br><span class="line">        <span class="keyword">return</span> textView;</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>생성자를 만들지 않거나, 기본 생성자를 만들고 아무짓도 하지 않는 것이다. 생성자를 명시하지 않는다면 Java는 자동적으로 기본 생성자를 만든다. 하지만, 기본 생성자를 명시하지 않고 오버로딩된 생성자만 명시하게 되면 <code>Fragment fragment = new Fragment();</code> 문장을 호출했을 때 에러를 겪게 된다. 그러니 기본 생성자를 사용하도록 하자.(대신 구현은 구현부는 비워놓는다.)</li>
<li>또한, 위에서 설명했던 것처럼 프래그먼트가 복구될 때는 기본 생성자를 호출하기 때문에 오버로딩된 생성자의 호출은 보장되지 않는다. 그래서 저장하거나 넘겨야 할 값이 존재한다면 <code>newInstance()</code> 함수에 파라미터로 전달하고 이 함수 안에서 Bundle 객체를 통해서 파라미터로 넘어온 값을 저장한다.</li>
<li>그리고 복원될 때는 <code>getArguments()</code> 함수를 통해서 값을 복원하면 된다.</li>
</ul>
<h2 id="참고">참고</h2>
<ul>
<li><a href="https://lanace.github.io/articles/why-do-not-use-arguments-in-fragment/" target="_blank" rel="noopener">왜 Fragment는 기본 생성자를 사용해야만 하는가?</a></li>
<li><a href="https://mrrays.tistory.com/921" target="_blank" rel="noopener">팩토리 메소드를 사용할 때 빈 기본 생성자가 필요한 이유</a></li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2019/02/06/Android-Why-is-Need-default-constructor-of-fragment/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2019/02/04/Android-What-is-DataBinding-1/"
                            aria-label=": 13일차 [안드로이드] 데이터바인딩"
                        >
                            13일차 [안드로이드] 데이터바인딩
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2019-02-04T11:45:42+09:00">
	
		    Feb 04, 2019
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Android/">Android</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <ul>
<li>데이터바인딩은 우리의 일상을 편하게 해주었다. 그러면 어떤 것을 편하게 해주었는지 먼저 살펴보고 시작해보자.</li>
</ul>
<ol>
<li>데이터바인딩을 사용하면 <code>findViewById()</code>를 호출하지 않아도 자동으로 xml에 만든 View들을 만들어준다.</li>
<li>RecyclerView에 각각의 item을 set해주는 작업도 xml에서 다 써주면 알아서 값이 들어간다.</li>
<li>값이 바뀌면 알아서 바뀐 값으로 View를 변경하게 할 수도 있고 기타 등등 유용하게 활용 할만한게 많다.</li>
</ol>
<h2 id="서론">서론</h2>
<p>새로운 화면을 추가해야 한다. 그러면 안드로이드 스튜디오를 켜고 xml을 만들고 레이아웃 화면을 구성해야 한다.</p>
<p>다음과 같이 TextView 5개와 Button 1개, RecyclerView 1개가 있는 View를 만들어 보도록 하겠다.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span>?&gt;</span><br><span class="line">&lt;LinearLayout xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">              android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">              android:layout_height=<span class="string">"match_parent"</span></span><br><span class="line">              android:orientation=<span class="string">"vertical"</span>&gt;</span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">        android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">        android:orientation=<span class="string">"horizontal"</span></span><br><span class="line">        &gt;</span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:id=<span class="string">"@+id/tvText1"</span></span><br><span class="line">            android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">            android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">            /&gt;</span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:id=<span class="string">"@+id/tvText2"</span></span><br><span class="line">            android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">            android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">            /&gt;</span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:id=<span class="string">"@+id/tvText3"</span></span><br><span class="line">            android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">            android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">            /&gt;</span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:id=<span class="string">"@+id/tvText4"</span></span><br><span class="line">            android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">            android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">            /&gt;</span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:id=<span class="string">"@+id/tvText5"</span></span><br><span class="line">            android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">            android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">            /&gt;</span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=<span class="string">"@+id/btnSample"</span></span><br><span class="line">            android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">            android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">            android:text=<span class="string">"button"</span></span><br><span class="line">            /&gt;</span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line">    &lt;android.support.v7.widget.RecyclerView</span><br><span class="line">        android:id=<span class="string">"@+id/rcContent"</span></span><br><span class="line">        android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">        android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">        /&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<p>xml을 만들었으니 Activity에서 View를 이어주는 작업을 해야한다. 아래와 같은 작업을 할 수 있다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">TextView tvText1;</span><br><span class="line">TextView tvText2;</span><br><span class="line">TextView tvText3;</span><br><span class="line">TextView tvText4;</span><br><span class="line">TextView tvText5;</span><br><span class="line">Button btnSample;</span><br><span class="line"></span><br><span class="line">RecyclerView rcContent;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">setContentView(R.layout.basic_activity);</span><br><span class="line"></span><br><span class="line">tvText1 = (TextView) findViewById(R.id.tvText1);</span><br><span class="line">tvText2 = (TextView) findViewById(R.id.tvText2);</span><br><span class="line">tvText3 = (TextView) findViewById(R.id.tvText3);</span><br><span class="line">tvText4 = (TextView) findViewById(R.id.tvText4);</span><br><span class="line">tvText5 = (TextView) findViewById(R.id.tvText5);</span><br><span class="line">btnSample = (Button) findViewById(R.id.btnSample);</span><br><span class="line">rcContent = (RecyclerView) findViewById(R.id.rcContent);</span><br></pre></td></tr></table></figure>
<p>위의 작업을 할 경우 우리는 제일 먼저 <code>findViewById()</code> 노가다를 진행한다. 지금 만들려는 레이아웃은 몇 개 안되는 뷰이지만 만약 10개, 100개 그리고 그 이상이라면 그만큼 노가다 코드를 작성하게 될 것이다.</p>
<p>그래서 이러한 노가다 코드를 줄일 수 있도록 도와주는 라이브러리인 <strong>버터 나이프</strong>가 있다. 자바에서는 버터 나이프를 이용해서 노가다 코드를 줄일 수 있었고, 코틀린에서는 <code>Kotlin-extensions</code>를 이용해서 findViewById를 하지 않아도 xml의 id를 바로 객체화시켜서 Activity에서 사용할 수 있었다.</p>
<p>아래는 버터 나이프를 이용한 축약된 형태의 코드 모습이다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@BindView</span>(R.id.tvText1)</span><br><span class="line">TextView tvText1;</span><br><span class="line"><span class="meta">@BindView</span>(R.id.tvText2)</span><br><span class="line">TextView tvText2;</span><br><span class="line"><span class="meta">@BindView</span>(R.id.tvText3)</span><br><span class="line">TextView tvText3;</span><br><span class="line"><span class="meta">@BindView</span>(R.id.tvText4)</span><br><span class="line">TextView tvText4;</span><br><span class="line"><span class="meta">@BindView</span>(R.id.tvText5)</span><br><span class="line">TextView tvText5;</span><br><span class="line"><span class="meta">@BindView</span>(R.id.btnSample)</span><br><span class="line">Button btnSample;</span><br><span class="line"></span><br><span class="line"><span class="meta">@BindView</span>(R.id.rcContent)</span><br><span class="line">RecyclerView rcContent;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">setContentView(R.layout.butterknife_activity);</span><br><span class="line">ButterKnife.bind(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>하지만 <strong>데이터바인딩</strong>을 사용한다면 어떻게 될까???</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>위의 화면은 오류가 아니다. 따로 View를 정의하고 우리가 이어줄 필요가 없다는 것이다. <strong>Databinding</strong>을 사용한다면 우리는 아무 소스코드를 적지 않아소 Databinding이 알아서 다 해준다.</li>
</ul>
<p><strong>최소사항</strong></p>
<ul>
<li>Android 2.1(API 7) 이상</li>
<li>Android Plugin for Gradle 1.5.0-alpha 1 이상</li>
<li>Android Studio 1.3 이상</li>
</ul>
<p>아주 아주 아주 옛날의 환경으로 작업하고 있지 않는 이상 지금 쓰는 환경에서 무리 없이 바로 사용할 수 있다.</p>
<p><strong>설정</strong><br>
<img src="/img/databinding_setting.png" width="400" height="300"></p>
<ul>
<li>build.gradle(Module:app) 에서 위와 같이 enabled만 true로 설정해주면 끝난다.</li>
</ul>
<p><strong>xml</strong></p>
<ul>
<li>Databinding을 사용하기 위해서는 xml의 최상위에 <layout> 태그를 감싸준다.</layout></li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span>?&gt;</span><br><span class="line"></span><br><span class="line">&lt;layout xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    xmlns:app=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span><br><span class="line">    xmlns:tools=<span class="string">"http://schemas.android.com/tools"</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;data&gt;</span><br><span class="line">        &lt;variable</span><br><span class="line">            name=<span class="string">"activity"</span></span><br><span class="line">            type=<span class="string">"app.woovictory.databindingsample.MainActivity"</span>/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/data&gt;</span><br><span class="line"></span><br><span class="line">    &lt;android.support.constraint.ConstraintLayout</span><br><span class="line">        android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">        android:layout_height=<span class="string">"match_parent"</span></span><br><span class="line">        tools:context=<span class="string">".MainActivity"</span>&gt;</span><br><span class="line"></span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">            android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">            android:text=<span class="string">"Hello World!"</span></span><br><span class="line">            app:layout_constraintBottom_toBottomOf=<span class="string">"parent"</span></span><br><span class="line">            app:layout_constraintLeft_toLeftOf=<span class="string">"parent"</span></span><br><span class="line">            app:layout_constraintRight_toRightOf=<span class="string">"parent"</span></span><br><span class="line">            app:layout_constraintTop_toTopOf=<span class="string">"parent"</span> /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/android.support.constraint.ConstraintLayout&gt;</span><br><span class="line"></span><br><span class="line">&lt;/layout&gt;</span><br></pre></td></tr></table></figure>
<p><strong>Java</strong></p>
<ul>
<li>Activity에서 항상 해주던 setContentView() 대신에 **DatabindingUtil.setContentView()**를 이용해서 layout xml을 이어준다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ActivityMainBinding binding;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line"></span><br><span class="line">binding = DataBindingUtil.setContentView(<span class="keyword">this</span>, R.layout.databinding_activity);</span><br><span class="line">binding.setActivity(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>xml의 파일 이름을 기준으로 ~~~Binding 클래스가 새로 생성된다.</li>
<li>여기서는 xml의 이름이 activity_main.xml이기 때문에 ActivityMainBinding 클래스가 새로 생성되었다.</li>
<li>Binding 클래스 이름의 생성은 파스칼 표기법 기준으로 변경된다.</li>
<li>예를 들어, woo_activity.xml -&gt; WooActivityBinding 클래스를 생성시킨다.</li>
<li>그리고 xml에서 layout 태그 안에 <data></data> 태그 안에 <variable></variable> 태그를 추가하고 activity라는 변수 이름을 할당해주면 위에서와 같이 <code>binding.setActivity(this)</code>처럼 Activity와 xml을 이어줄 수 있다.</li>
</ul>
<p>View를 사용하고자 할 때는 binding 변수에서 아래와 같이 사용할 수 있다.</p>
<img src="/img/databinding_binding.png" width="400" height="300">
<ul>
<li>View의 이름은 카멜표기법 기준으로 변경된다.</li>
<li>@+id/tv1_text 의 뷰는 tv1Text으로 이름이 변경되어 사용할 수 있다.</li>
</ul>
<h2 id="click-event">Click Event</h2>
<ul>
<li>사용자가 어떤 버튼을 클릭하면 아래의 함수를 실행하도록 하려고 한다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onButtonClick</span><span class="params">(View view)</span></span>&#123;</span><br><span class="line">    Toast.makeText(<span class="keyword">this</span>, <span class="string">"Button Click"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>기본</strong></p>
<p>버튼에 <code>setOnClickListener()</code>를 달아서 클릭이벤트를 받아주도록 할 것이다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//btnSample.setOnClickListener(this);</span></span><br><span class="line">btnSample.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">onButtonClick(view);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>위에 주석 처리된 것처럼 setOnClickListener(this)를 했다면 implements View.OnClickListener를 하고 함수를 오버라이드 하고 그 안에서 onButtonClick() 함수를 호출했을 것이다.</li>
</ul>
<p><strong>버터나이프</strong></p>
<ul>
<li>버터나이프에서는 @OnClick(<a href="http://R.id.xxx" target="_blank" rel="noopener">R.id.xxx</a>)만 함수에 넣어주면 된다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OnClick</span>(R.id.btnSample)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onButtonClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">Toast.makeText(<span class="keyword">this</span>, <span class="string">"Button Click"</span>, Toast.LENGTH_SHORT).show();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>버터 나이프는 아주 간단하게 이벤트를 처리할 수 있다.</li>
</ul>
<p><strong>데이터바인딩</strong></p>
<ul>
<li>데이터바인딩은 xml에서 클릭되면 실행하고자 하는 함수를 지정해준다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button</span><br><span class="line">    android:id=<span class="string">"@+id/btn2"</span></span><br><span class="line">    android:onClick=<span class="string">"@&#123;activity.onButtonClick2&#125;"</span></span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span> /&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>위에서는 android:onClick 에서 activity라는 곳에 있는 onButtonClick2() 함수를 실행하도록 설정해두었다.</li>
<li>여기서 activity라는 것은 xml에서 선언해 둔 변수를 가리킨다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;layout xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    xmlns:app=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span><br><span class="line">    xmlns:tools=<span class="string">"http://schemas.android.com/tools"</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;data&gt;</span><br><span class="line">        &lt;variable</span><br><span class="line">            name=<span class="string">"activity"</span></span><br><span class="line">            type=<span class="string">"app.woovictory.databindingsample.MainActivity"</span>/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/data&gt;</span><br><span class="line">    <span class="comment">// 생략</span></span><br></pre></td></tr></table></figure>
<ul>
<li>xml에서 <data> 태그를 이용해서 그 안에서 각각 사용하고자 하는 변수를 <variable> 태그를 이용해서 정의해주면 사용할 수 있다.</variable></data></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">BaseActivity</span>&lt;<span class="title">ActivityMainBinding</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line"></span><br><span class="line">        binding.setActivity(MainActivity.<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onButtonClick2</span><span class="params">(View view)</span></span>&#123;</span><br><span class="line">        Toast.makeText(<span class="keyword">this</span>, <span class="string">"Click222"</span>,Toast.LENGTH_LONG).show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>위의 예제는 데이터바인딩을 수행하는 부분을 BaseActivity로 빼두어서 설정하는 코드가 보이지 않는다. 하지만, 바인딩 하는 부분이 수행된다.</li>
<li>Java 파일에서는 이 변수가 어떤 값을 넣어줄건지 지정해주어야 한다.</li>
<li>setActivity() 함수는 자동으로 생성된 함수이다. 우리가 <strong>xml에서 activity라는 변수를 만들었다면 자동으로 setActivity()가 생성되어서</strong> binding.setActivity(this) 처럼 사용할 수 있는 것이다.</li>
<li>setActivity(this)가 xml에서의 activity라는 변수를 이 Class로 지정하겠다는 의미인 것이다. 즉, xml의 activity 변수는 MainActivity Class와 연결되고 MainActivity의 변수 혹은 함수를 참조할 수 있음을 의미한다.</li>
</ul>
<p>MVP 패턴을 사용한다면 presenter를, MVVM 패턴을 사용한다면 ViewModel을 활용해서 클릭 이벤트에 맞는 동작을 수행하도록 지정하면 된다. <code>이에 대한 나의 생각은 조금 다르다.</code> MVP 패턴은 View에서 발생한 이벤트를 Presenter에게 위임하여 View는 단순히 View 그 자체를 그리는 것에만 초점을 맞추어 관심사를 분리한 것으로 볼 수 있다. View에서 발생한 이벤트 혹은 요청한 이벤트가 데이터를 불러오거나 가공하는 로직이 포함된다면 Presenter에게 위임하여 처리하는 것이 맞다고 생각을 한다.</p>
<p>그리고 View에서 발생한 이벤트가 단순히 화면 전환과 같은 이벤트라면 View에서 처리해도 마땅하다고 생각을 한다.</p>
<p>함수 이름을 지정할 때 기존에는 @{activity.함수이름()}으로 해도 문제가 없었지만 언젠가부터 이 방법은 deprecated 되었다고 나온다고 한다. 그래서 @{activity::함수이름()}으로 사용하도록 구글 문서에서 안내하고 있다.</p>
<h2 id="recyclerview-리스트">RecyclerView 리스트</h2>
<p>그렇다면 이제 RecyclerView를 이용해서 리스트 목록을 만드는 작업을 해보려고 한다. 기본적으로 1:1 카카오톡의 채팅방과 같이 사용자의 사진, 이름, 그리고 여기서는 나이로 구성되어 있는 화면을 만들어보겠다. 먼저, item을 구성하는 xml을 정의해야 한다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:gravity</span>=<span class="string">"center_vertical"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:padding</span>=<span class="string">"8dp"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">de.hdodenhof.circleimageview.CircleImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/ivProfile"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"40dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"40dp"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginLeft</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/tvName"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/tvAge"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginTop</span>=<span class="string">"8dp"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>또한, 리스트에서 쓰일 사용자 User 클래스도 생성해준다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> app.woovictory.databindingsample;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    String name;</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">    String imageUrl;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String name, <span class="keyword">int</span> age, String imageUrl)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.imageUrl = imageUrl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getImageUrl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> imageUrl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>실제로는 서버에서 사용자의 목록을 받아오겠지만 여기서는 샘플 데이터를 이용해서 활용할 수 있도록 구성한다.</li>
</ul>
<h3 id="viewholder">ViewHolder</h3>
<ul>
<li>각각의 item view를 보여주기 위해서 ViewHolder에서 View를 만들어주는 작업을 한다.</li>
</ul>
<p><strong>기본</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    TextView tvName;</span><br><span class="line">    TextView tvAge;</span><br><span class="line">    ImageView ivProfile;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserViewHolder</span><span class="params">(View itemView)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(itemView);</span><br><span class="line">        tvName = (TextView) itemView.findViewById(R.id.tvName);</span><br><span class="line">        tvAge = (TextView) itemView.findViewById(R.id.tvAge);</span><br><span class="line">        ivProfile = (ImageView) itemView.findViewById(R.id.ivProfile);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>버터나이프</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BindView</span>(R.id.tvName)</span><br><span class="line">    TextView tvName;</span><br><span class="line">    <span class="meta">@BindView</span>(R.id.tvAge)</span><br><span class="line">    TextView tvAge;</span><br><span class="line">    <span class="meta">@BindView</span>(R.id.ivProfile)</span><br><span class="line">    ImageView ivProfile;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserViewHolder</span><span class="params">(View itemView)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(itemView);</span><br><span class="line">        ButterKnife.bind(<span class="keyword">this</span>,itemView);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>데이터바인딩</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    DatabindingItemBinding binding;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserViewHolder</span><span class="params">(View itemView)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(itemView);</span><br><span class="line">        binding = DataBindingUtil.bind(itemView);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>위에서 순서대로 기본 -&gt; 버터 나이프 -&gt; 데이터바인딩을 차례대로 살펴보면 코드의 길이가 짧아지는 것을 확인할 수 있다. 그렇다. 데이터바인딩을 사용하면 개발자가 작성해야 할 코드의 양이 줄어든다!!</li>
</ul>
<h3 id="item-세팅">item 세팅</h3>
<ul>
<li>onBindView() 함수에서 각각의 position에 맞는 User 클래스의 내용에 따라 뷰의 내용을 넣어주는 작업을 해준다.</li>
</ul>
<p><strong>기본/버터나이프</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindView</span><span class="params">(UserViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    User user = getItem(position);</span><br><span class="line"></span><br><span class="line">    String name = user.getName();</span><br><span class="line">    holder.tvName.setText(name);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> age = user.getAge();</span><br><span class="line">    holder.tvAge.setText(Integer.toString(age));</span><br><span class="line"></span><br><span class="line">    String imgUrl=user.getImgUrl();</span><br><span class="line">    ImageUtil.loadImage(holder.ivProfile,imgUrl, ContextCompat.getDrawable(getContext(),R.drawable.no_pic));</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>데이터바인딩</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindView</span><span class="params">(UserViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    User user = getItem(position);</span><br><span class="line">    holder.binding.setUser(user);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>원래는 기본이나 혹은 버터나이프에서는 각각의 holder의 view에 사용자 정보를 넣어주는 작업을 해주었지만 데이터바인딩에서는 그럴 필요가 없다.</li>
<li><code>setUser()</code> 라는 함수를 보고 유추해 볼 수 있다. item_user.xml에서 user라는 변수를 만들어주었고, 그 변수에 setUser()라는 데이터바인딩에 의해서 생성된 함수를 통해서 position에 따른 user 객체를 할당해준다는 것을 알 수 있다.</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">layout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">variable</span></span></span><br><span class="line"><span class="tag">            <span class="attr">name</span>=<span class="string">"user"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">type</span>=<span class="string">"app.woovictory.databindingsample.User"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>onBindView()에서 값을 넣어주는 대신에 setUser()를 통해서 User 객체를 user 변수에 할당해준다. 그리고 데이터바인딩을 통해서 xml에서 값을 넣어준다.</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:id</span>=<span class="string">"@+id/tvName"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:text</span>=<span class="string">"@&#123;user.name&#125;"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:id</span>=<span class="string">"@+id/tvAge"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:text</span>=<span class="string">"@&#123;Interger.toString(user.age)&#125;"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:layout_marginTop</span>=<span class="string">"8dp"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>android:text에 @{user.필드이름}을 넣어주는 것만으로 user의 정보를 가져와서 다시 TextView에 넣어주는 작업을 해 줄 필요가 없는 것이다.</li>
</ul>
<h3 id="bindingadapter">@BindingAdapter</h3>
<p>그런데 여기서 드는 의문이 하나 있다. User 정보 중에 imageUrl이라는 필드는 “<a href="http://~~~.png" target="_blank" rel="noopener">http://~~~.png</a>” 처럼 이미지가 저장되어 있는 주소 값으로 되어 있다. 이 값을 TextView에 넣는다면 이미지 url만 출력되는 원하지 않는 결과를 볼 것이다.</p>
<p>이럴 때 BindingAdapter를 사용하면 해결할 수 있다. 어노테이션으로 <code>@BindingAdapter</code>와 같이 정의해준다. 나는 이미지를 Setting하기 위해서 다음과 같이 정의한다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@BindingAdapter</span>(<span class="string">"app:imageUrl"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loadImage</span><span class="params">(ImageView imageView, String url)</span></span>&#123;</span><br><span class="line">    ImageUtil.loadImage(imageView, url);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>그러면 UserAdapter에서 onBindView() 함수가 binding.setUser(user)를 호출하면서 데이터바인딩 작업이 수행된다. 그리고 xml에서 정의한 다음의 문장을 수행하게 된다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">de.hdodenhof.circleimageview.CircleImageView</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:id</span>=<span class="string">"@+id/ivProfile"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:layout_width</span>=<span class="string">"40dp"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">app:imageUrl</span>=<span class="string">"@&#123;user.imageUrl&#125;"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:layout_height</span>=<span class="string">"40dp"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>그러면 xml에서 @BindingAdapter로 정의된 부분을 찾아서 해당 View의 id와 @{user.imageUrl} 을 가지고 @BindingAdapter가 정의된 함수의 파리미터로 값을 전달하게 된다.</li>
<li>loadImage 함수를 호출하면서 파라미터로 id와 user.imageUrl에 담긴 url 값을 넘긴다.</li>
</ul>
<p>+<code>@BindinAdapter</code>와 <code>@BindinConversion</code>은 유용하게 사용할 수 있다. 이와 관련된 내용은 추후 구글 공식 문서를 통해서 내용을 추가할 예정이다.<br>
+Observable</p>
<h2 id="참고">참고</h2>
<ul>
<li><a href="https://gun0912.tistory.com/71" target="_blank" rel="noopener">[안드로이드/Android]DataBinding - Goodbye 버터나이프 Hello 데이터바인딩[박상권의 삽질블로그]</a></li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2019/02/04/Android-What-is-DataBinding-1/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2019/01/31/Android-AAC-Room/"
                            aria-label=": 11일차 [안드로이드] AAC - Room 실습"
                        >
                            11일차 [안드로이드] AAC - Room 실습
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2019-01-31T22:32:55+09:00">
	
		    Jan 31, 2019
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Android/">Android</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>Room은 Android Architecture Components(AAC) 중 하나이다. Room에 대해서 저번에 살펴봤지만, 헷갈리고 개념이 정립되어 있지 않아 다시 정리하려고 한다. 이번에는 개념적인 부분보다는 실제로 어떻게 사용을 할 수 있는지에 초점을 맞추려고 한다.</p>
<h2 id="room의-3가지-주요-구성요소">Room의 3가지 주요 구성요소</h2>
<ul>
<li>RoomDatabase : 데이터베이스의 holder를 구성하며 관계형 데이터에 대한 연결을 해준다.</li>
<li>조건
<ol>
<li>RoomDatabase를 extends하는 클래스는 <strong>abstract</strong> 클래스이다.</li>
<li>annotaion으로 eneities(Table 구조와 mapping되는 clas)를 포함해야 한다.</li>
<li>클래스 내부에 DAO(Data Access Object)를 포함해야 한다.</li>
</ol>
</li>
<li>Entity : 데이터베이스 내의 테이블을 나타낸다.</li>
<li>Dao : 데이터베이스에 접근하는 데 사용되는 함수를 정의한다.(Query를 포함한다.)</li>
</ul>
<img src="/img/room_Database_structure.png" width="600" height="300">
<h2 id="entity">Entity</h2>
<ul>
<li>Entity는 object이자 데이터베이스의 테이블을 나타낸다.</li>
<li>Entity 파일의 특징은 class의 변수들이 column이 되어 데이터베이스의 테이블로 된다는 것이다.</li>
<li>ColumnInfo로 필드의 이름을 설정하지 않는다면 필드의 이름과 같은 Column 이름으로 생성된다.</li>
<li>이때, 실제 table로 만들고 싶지 않은 필드에는 @Ignore 어노테이션을 선언한다.</li>
</ul>
<p><strong>Annotation 속성</strong></p>
<p>@Entity(name = “word_table”)<br>
: Entity의 테이블 명을 선언한다.<br>
@PrimaryKey<br>
: 모든 Entity는 PrimaryKey가 필요하다.(값을 구별하기 위한 식별자)<br>
@ColumnInfo(name = “word”)<br>
: 테이블에서 word라는 이름으로 데이터베이스 column 사용</p>
<p><code>Entity에는 getter 함수가 필수적으로 존재해야 하고 변수들은 public 형태여야 한다.</code></p>
<p>@Embeded<br>
: 필드로 object를 갖는 경우 사용한다.</p>
<ul>
<li>Annotaion과 관련된 속성은 구글 공식 문서를 참고하거나 블로그의 다른 글을 참고하면 좋을 것 같다.</li>
<li><a href="https://woovictory.github.io/2019/01/25/Android-Room-Basic/">5일차 [안드로이드] Room</a></li>
</ul>
<h2 id="dao-만들기">DAO 만들기</h2>
<ul>
<li>DAO는 SQL 쿼리를 지정하고 메소드 호출을 연결한다.</li>
<li>쿼리는 별도의 스레드에서 동작하며 메인 스레드에서 동작하지 않는다.(UI - Thread에서는 동작하면 앱에 에러가 난다.)</li>
<li>Interface class 혹은 abstract class로 사용한다.</li>
<li>@Dao 어노테이션을 지정한다.</li>
<li>Dao에서는 데이터베이스에 있는 테이블에서 사용할 쿼리를 지정하고 메소드와 연결을 한다. 단순히 정의만 해놓는다.</li>
</ul>
<p><strong>주의</strong></p>
<p>AppDatabase object를 생성하는 코드는 비용이 많이 들기 때문에 <strong>Singleton</strong>으로 구현해야 한다.</p>
<h2 id="room-database-만들기">Room Database 만들기</h2>
<ul>
<li>Room Database는 SQLite 데이터베이스 상위에 있는 데이터베이스 계층을 말한다.</li>
<li>Room은 DAO를 이용하여 데이터베이스의 쿼리를 실행한다.</li>
<li>기본적으로 UI 성능 저하를 피하기 위해서 Room에서는 main thread에서 쿼리를 실행할 수 없다.</li>
<li><strong>LiveData</strong>는 필요할 때 백그라운드 스레드에서 쿼리를 비동기적으로 자동 실행하여 규칙을 적용한다.</li>
<li>Room 클래스는 abstract 여야 하며, RoomDatabase를 상속받아야 한다.</li>
<li>일반적으로 RoomDatabase 객체를 생성하는 코드는 비용이 많이 들기 때문에 싱글톤으로 구현해 하나의 객체만 유지한다.</li>
</ul>
<p><strong>어노테이션</strong><br>
@Database(entities = {Word.class}, version = 1)<br>
: Room Database를 정의한다. entities는 데이터베이스에 사용될 Entity를 나타낸다. version는 추후 데이터베이스의 변경 사항이 있을 시 변경해야 할 사항이다.</p>
<h2 id="repository-만들기">Repository 만들기</h2>
<ul>
<li>Repository는 여러 데이터에 대한 접근을 할 수 있는 class이다.</li>
<li>주로 로컬 데이터(앱 내장 데이터)를 가져올 지 네트워크에서 데이터를 가져올 지를 다룬다.</li>
</ul>
<img src="/img/android_room_repository.png" width="600" height="300">
<ul>
<li>Dao의 멤버 변수와 word를 넣을 list 변수를 만들어 준다.</li>
<li>AsyncTask를 만들어서 Database에 insert 하는 작업을 수행한다.</li>
<li>이유는? UI - Thread에서 수행할 경우 오류가 발생한다.</li>
</ul>
<h2 id="viewmodel">ViewModel?</h2>
<p>내가 참고한 예제에서는 <strong>ViewModel</strong>을 사용하였다. 하지만, ViewModel에 대한 이해가 잘 되지 않아서 사용하지 않고 예제를 조금 다른 방식으로 수정하였다. 그래도 일단, ViewModel이 무엇인지 간단하게 살펴보자.</p>
<ul>
<li>ViewModel의 역할은 UI에 데이터를 제공하고 변경된 사항들을 업데이트 해준다.</li>
<li>그리고 ViewModel 저장소(Repository)와 UI(Fragment / Activity) 사이에 통신 역할을 한다.</li>
<li>이것은 <strong>저장소와 UI를 분리</strong>하여 각자의 역할을 명확하게 할 수 있다.</li>
</ul>
<p><strong>주의</strong></p>
<ol>
<li>
<p>ViewModel에 context를 저장하면 안된다.<br>
-&gt; 이유는 디바이스가 회전할 때 Activity가 제거되었다가 다시 생성되는데 이때, ViewModel은 제거된 것을 참조하기 때문에 <strong>메모리 누수</strong>가 발생한다. 그래서 application을 사용하기 위해 extends로 AndroidViewModel을 사용한다.</p>
</li>
<li>
<p>ViewModel은 프로세스 종료 후 남아있지 않기 때문에 onSaveInstanceState() 함수를 대체하지 않는다.</p>
</li>
</ol>
<h2 id="livedata">LiveData??</h2>
<p>LiveData는 중요한 개념 중 하나이다. 여기서는 간단하게 Room에서 어떻게 사용되는지만 보고 추후에 공부할 예정이다.</p>
<ul>
<li><code>observer</code>라는 것을 만들어 실제 변경이 일어나면 UI에 적용한다.</li>
<li>ViewModel에서 데이터베이스 호출 없이 코드를 쉽게 테스트할 수 있다.</li>
</ul>
<p>예제는 Github에 있으니 확인할 수 있다.</p>
<h2 id="참고">참고</h2>
<ul>
<li><a href="https://codelabs.developers.google.com/codelabs/android-room-with-a-view/#16" target="_blank" rel="noopener">Android Room with a View - Java</a></li>
<li><a href="https://m.blog.naver.com/rjs5730/221302132817" target="_blank" rel="noopener">(Android) Room Persistence Library 실습 -2</a></li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2019/01/31/Android-AAC-Room/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2019/01/30/DatabaseBasic/"
                            aria-label=": 10일차 [데이터베이스] 데이터베이스 기초 "
                        >
                            10일차 [데이터베이스] 데이터베이스 기초 
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2019-01-30T11:08:34+09:00">
	
		    Jan 30, 2019
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/데이터베이스/">데이터베이스</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>안드로이드에서 Room을 이용하면 내부 DB를 사용할 수 있고, 간단한 쿼리문도 사용할 수 있다. 여기까지는 문제가 없는데, 내가 서버, DB 용어와 개념을 몰라서 이해가 잘 안간다. 그래서 간단하게 찾아서 공부하기 위해 작성된 글이다.</p>
<h2 id="데이터베이스란">데이터베이스란??</h2>
<ul>
<li><strong>여러 사람에 의해 공유되어 사용될 목적으로 통합하여 관리되는 데이터의 집합을 말한다.</strong> 자료 항목의 중복을 없애고 자료를 구조화하여 저장함으로써 자료 검색과 갱신의 효율을 높인다.</li>
<li>논리적으로 연관된 하나 이상의 자료의 모음으로 그 내용을 고도로 구조화함으로써 검색과 갱신의 효율화를 꾀한 것이다.</li>
<li>몇 개의 자료 파일을 조직적으로 통합하여 자료 항목의 중복을 없애고 자료를 구조화하여 기억시켜 놓은 자료의 집합체라고 할 수 있다.</li>
</ul>
<p><strong>왜 사용하는가?</strong></p>
<p><strong>데이터베이스란 다수의 사용자가 사용하는 데이터들의 공유와 운영을 위해 저장해 놓는 공간을 말한다.</strong> 프로그램을 만들다 보면 프로그램 사용자들에 의해 생성된 데이터, 프로그래머가 필요에 의해 프로그램에 넣어 놓은 데이터 등 필연적으로 많은 데이터들이 생성되어지게 된다. 여기서 데이터베이스를 사용하지 않으면 이 데이터들은 프로그램을 종료하는 순간 전부 날아가게 되는 불행한 상황을 맞이하게 된다.</p>
<p>따라서, 이런 현상을 방지하기 위해 데이터들을 데이터베이스에 넣고 보관하는 방법을 사용하는 것이다.</p>
<h2 id="기초-용어">기초 용어</h2>
<ul>
<li>엔티티(Entity) : <strong>사람, 장소, 사물, 사건 등과 같이 독립적으로 존재하면서 고유하게 식별이 가능한 실세계의 객체이다.</strong> 예를 들어, 사원 번호가 1206이고 김창섭인 사원, 과목 코드가 CS372인 운영체제 등이 있다. 이렇게 실체가 있는 것 뿐만 아니라 추상적인 것도 있다. 프로젝트 번호가 P101인 프로젝트, 학과 번호가 D316인 학과는 추상적인 개념의 엔티티가 될 수 있다.</li>
<li>스키마(Schema) : 데이터를 설명하는 데이터. 메타데이터(Metadata)라고도 한다. 예를 들어 <code>홍길동, 1994-06-27</code>이라는 데이터가 있을 경우에는 이를 <code>이름, 생년원일</code>이라는 스키마로 설명할 수 있다.</li>
</ul>
<h2 id="database-용어">Database 용어</h2>
<img src="/img/database_basic.png" width="600" height="300">
<ul>
<li>Table(Relation) : 관계형 데이터베이스에서 정보를 구분하여 저장하는 기본 단위를 말한다. 예로 부서에 관한 정보를 저장하는 부서 Relation(혹은 부서 Table)이 있다. 한 릴레이션은 데이터베이스에 표현되는 한 엔티티에 관한 정보를 저장하는 데 사용된다.</li>
<li>식별자(identifier) : 여러 개의 집합체를 담고 있는 관계형 데이터베이스에서 각각을 구분할 수 있는 논리적인 개념이다.</li>
<li>식별자의 특징
<ul>
<li>유일성 : 하나의 릴레이션에서 모든 행은 서로 다른 키 값을 가져야 한다.</li>
<li>최소성 : 꼭 필요한 최소한의 속성들로만 키를 구성해야 한다.</li>
</ul>
</li>
<li>튜블(Tuple) : 테이블에서 행을 의미한다. 같은 말로 레코드(Record) 혹은 로우(Row)라고 하기도 한다. 튜플은 릴레이션에서 같은 값을 가질 수 없다.
<ul>
<li>카디날리티(Cardinality) : 튜플의 수</li>
</ul>
</li>
<li>어트리뷰트(Attribute) : 테이블에서 열을 의미한다. 같은 말로 칼럼(Column)이라고도 한다.
<ul>
<li>디그리(Degree) : 어트리뷰트의 수를 의미한다.</li>
</ul>
</li>
<li>도메인(Domain) : Relation에서 각각의 속성(Attribute)들이 취할 수 있는 같은 타입의 원자 값들의 집합이다.</li>
</ul>
<h2 id="key">Key</h2>
<ul>
<li>키(Key) : 한 Relation에서 각각의 Tuple(행)을 유일하게 식별하기 위해 사용하는 하나 혹은 그 이상의 속성들(Attribute)의 집합이다.</li>
</ul>
<p><strong>유일성과 최소성</strong></p>
<ul>
<li>유일성 : 하나의 키로 어떠한 행을 바로 찾아낼 수 있는 성질. ex) 주민등록번호</li>
<li>최소성 : 레코드(튜플)을 식별하는데 꼭 필요한 속성들로만 구성되어 있는 성질. ex) {주민등록번호+학번}은 최소성을 만족시키지 않는다. 주민등록번호로만 tuple(행)을 구분할 수 있기 때문이다.</li>
</ul>
<img src="/img/student_relation.png" width="800" height="300">
<img src="/img/sukang_relation.png" width="800" height="300">
<ol>
<li>후보키(Cadidate Key)</li>
</ol>
<ul>
<li>릴레이션을 구성하는 속성들 중에서 튜블을 <strong>유일하게 식별할 수 있는 속성들의 부분집합을 의미한다.</strong></li>
<li>모든 릴레이션은 반드시 하나 이상의 후보키를 가져야한다.</li>
<li>릴레이션에 있는 모든 튜플에 대해서 유일성과 최소성을 만족시켜야 한다.</li>
</ul>
<p>ex) &lt;학생&gt; 릴레이션에서 '학번’이나 '주민번호’는 다른 레코드를 유일하게 구별할 수 있는 기본키로 사용할 수 있으므로 후보키가 될 수 있다. 즉, 기본키가 될 수 있는 키들을 후보키라고 한다.</p>
<ol start="2">
<li>기본키(Primary Key)</li>
</ol>
<ul>
<li>후보키 중에서 선택한 주키(Main key)</li>
<li>한 릴레이션에서 <strong>특정 튜플을 유일하게 구별할 수 있는 속성</strong></li>
<li><strong>Null 값을 가질 수 없다.</strong>(개체 무결성의 첫 번째 조건)</li>
<li>기본 키로 정의된 속성에는 <strong>동일한 값이 중복되어 저장될 수 없다.</strong>(개체 무결성의 두 번째 조건)</li>
</ul>
<p>ex) &lt;학생&gt; 릴레이션에서는 '학번’이나 '주민번호’기 기본키가 될 수 있고, &lt;수강&gt; 릴레이션에서는 ‘학번’+'과목명’으로 조합해야 기본키가 만들어 질 수 있다. 왜냐하면 &lt;수강&gt; 릴렝션에서는 ‘학번’ 속성과 ‘과목명’ 속성은 개별적으로 기본키로 사용할 수 없다. 다른 튜플들과 구별되지 않기 때문이다.</p>
<p>1004 학번을 가진 학생이 영어와 전산 과목을 수강하고 있다고 하면 학번만으로는 특정 튜플을 유일하게 구별할 수 없다. 그리고 영어 과목을 수강하는 학생들은 한명이 아니라 여러 명이 될 수 있기 때문에 유일하게 구별할 수 없다.</p>
<ol start="3">
<li>대체키(Alternate Key)</li>
</ol>
<ul>
<li><strong>후보키가 둘 이상일 때 기본키를 제외한 나머지 후보키들을 말한다.</strong></li>
<li>보조키라고도 한다.</li>
</ul>
<p>ex) &lt;학생&gt; 릴레이션에서 '학번’을 기본키로 정의하면 '주민번호’는 대체키가 된다.</p>
<ol start="4">
<li>슈퍼키(Super Key)</li>
</ol>
<ul>
<li><strong>슈퍼키는 한 릴레이션 내에 있는 속성들의 집합으로 구성된 키</strong>로서 릴레이션을 구성하는 모든 튜플 중 슈퍼키로 구성된 속성의 집합과 동일한 값은 나타내지 않는다.</li>
<li>릴레이션을 구성하는 모든 튜플에 대해 <strong>유일성은 만족하지만, 최소성은 만족시키지 못한다.</strong></li>
</ul>
<p>ex) &lt;학생&gt; 릴레이션에서는 ‘학번’, ‘주민번호’, ‘학번’+‘주민번호’+‘성명’ 등으로 슈퍼키를 구성할 수 있다. 또한, 여기서 최소성을 만족시키지 못한다는 말은 ‘학번’+‘주민번호’+'성명’가 슈퍼키인 경우 3개의 속성 조합을 통해 다른 튜플과 구별이 가능하지만, ‘성명’ 단독적으로 슈퍼키를 사용했을 때는 구별이 가능하지 않기 때문에 최소성을 만족시키지 못한다.</p>
<p>즉, 뭉쳤을 경우 유일성이 생기고, 흩어지면 몇몇 속성들은 독단적으로 유일성 있는 키로 사용할 수 없다. 이것을 최소성을 만족하지 못한다고 한다.</p>
<ol start="5">
<li>외래키(Foreign Key)</li>
</ol>
<ul>
<li>관계(Relation)를 맺고 있는 릴레이션 R1, R2에서 릴레이션 R1이 참조하고 있는 릴레이션 R2의 기본키와 같은 R1 릴레이션의 속성이다.</li>
<li>외래키는 <strong>참조되는 릴레이션의 기본키와 대응되어 릴레이션 간에 참조 관계를 표현하는데 중요한 도구</strong>로 사용된다.</li>
<li><strong>외래키로 지정되면 참조하는 테이블의 기본키에 없는 값은 입력할 수 없다.</strong>(참조 무결성 조건)</li>
</ul>
<p>ex) &lt;수강&gt; 릴레이션이 &lt;학생&gt; 릴레이션을 참조하고 있으므로 &lt;학생&gt; 릴레이션의 '학번’은 기본키이고, &lt;수강&gt; 릴레이션의 '학번’은 외래키이다.<br>
즉, 각 릴레이션의 입장에서 속성은 기본키가 되기도 하고, 외래키가 되기도 한다.</p>
<p>ex) &lt;수강&gt; 릴레이션의 '학번’에는 &lt;학생&gt; 릴레이션의 '학번’에 없는 값은 입력할 수 없다.</p>
<h2 id="쿼리-문법의-세-종류와-각-문법">쿼리 문법의 세 종류와 각 문법</h2>
<p><strong>SQL</strong>(Structured Query Language)</p>
<ul>
<li>관계형 데이터베이스에서 사용하는 표준 질이 언어를 말한다.</li>
<li>사용 방법이나 문법이 다른 언어(Java, C, C#)보다 단순하다.</li>
<li>모든 DBMS에서 사용 가능하다.</li>
<li>인터프리터 언어</li>
<li>대소문자를 구별하지 않는다.</li>
</ul>
<ol>
<li>데이터 정의 언어(DDL)</li>
</ol>
<ul>
<li>데이터베이스 검색, 등록, 삭제, 갱신을 하기 위해 사용하는 데이터베이스 언어</li>
<li>데이터베이스의 검색 및 업데이트 등 데이터 조작을 위해 사용</li>
<li>데이터베이스의 스키마를 정의, 생성, 수정하는 기능</li>
<li>테이블 생성, 컬럼 추가, 타입 변경, 각종 제약조건 지정, 수정 등</li>
</ul>
<table>
<thead>
<tr>
<th>SQL문</th>
<th>내용</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>create</code></td>
<td>데이터베이스 객체를 생성</td>
</tr>
<tr>
<td><code>drop</code></td>
<td>데이터베이스 객체를 삭제</td>
</tr>
<tr>
<td><code>alter</code></td>
<td>기존에 존재하는 데이터베이스 객체를 다시 정의</td>
</tr>
</tbody>
</table>
<ol start="2">
<li>데이터 조작 언어(DML)</li>
</ol>
<ul>
<li>관계형 데이터베이스의 구조를 정의한다.</li>
<li>쌍, 속성, 관계 인덱스 파일 위치 등 데이터베이스 고유의 특성을 포함한다.</li>
<li>데이터베이스의 테이블에 있는 내용을 직접 조작하는 기능</li>
<li>테이블의 레코드(튜플)을 CRUD(Create, Retrieve, Update, Delete)</li>
</ul>
<table>
<thead>
<tr>
<th>SQL문</th>
<th>내용</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>insert</code></td>
<td>데이터베이스 객체에 데이터를 입력</td>
</tr>
<tr>
<td><code>delete</code></td>
<td>데이터베이스 객체에 데이터를 삭제</td>
</tr>
<tr>
<td><code>update</code></td>
<td>데이터베이스 객체 안의 데이터 수정</td>
</tr>
<tr>
<td><code>select</code></td>
<td>데이터베이스 객체 안의 데이터 조회</td>
</tr>
</tbody>
</table>
<ol start="3">
<li>데이터 제어 언어(DCL)</li>
</ol>
<ul>
<li>데이터베이스에서 데이터에 대한 액세스를 제어하기 위한 데이터베이스 언어 또는 데이터베이스 언어 요소</li>
<li>박탈, 연결, 권한 부여, 질의, 자료 삽입, 갱신, 삭제 등</li>
<li>데이터베이스의 테이블에 접근 권한이나 CRUD 권한을 정의하는 기능</li>
<li>특정 사용자에게 테이블의 조회권한 허가 / 금지 등</li>
</ul>
<table>
<thead>
<tr>
<th>SQL문</th>
<th>내용</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>grant</code></td>
<td>데이터베이스 객체에 권한을 부여</td>
</tr>
<tr>
<td><code>revoke</code></td>
<td>이미 부여된 데이터베이스 객체 권한을 취소</td>
</tr>
</tbody>
</table>
<h2 id="crud">CRUD</h2>
<p>CRUD(Create, Retrieve, Update, Delete)</p>
<table>
<thead>
<tr>
<th>이름</th>
<th>조작</th>
<th>SQL</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>create</code></td>
<td>생성</td>
<td>insert</td>
</tr>
<tr>
<td><code>read(retrieve)</code></td>
<td>읽기(인출)</td>
<td>select</td>
</tr>
<tr>
<td><code>update</code></td>
<td>갱신</td>
<td>update</td>
</tr>
<tr>
<td><code>delete</code></td>
<td>삭제</td>
<td>delete</td>
</tr>
</tbody>
</table>
<ul>
<li>Create : 데이터베이스 객체 생성
<ul>
<li>insert into</li>
<li>새로운 레코드를 추가</li>
</ul>
</li>
<li>Update : 데이터베이스 객체 안의 데이터를 수정
<ul>
<li>update</li>
<li>특정 조건의 레코드의 컬럼 값을 수정</li>
</ul>
</li>
<li>Delete : 데이터베이스 객체의 데이터 삭제
<ul>
<li>delete</li>
<li>특정 조건의 레코드를 삭제</li>
</ul>
</li>
<li>Retrieve : 데이터베이스 객체 안의 데이터 검색
<ul>
<li>select</li>
<li>조건을 만족하는 레코드를 찾아 특정 컬럼 값을 표시(모두 표시 : *)</li>
</ul>
</li>
</ul>
<h2 id="예제">예제</h2>
<p><strong>1.select 명령문</strong><br>
SELECT 컬럼명 FROM 테이블명 WHERE 조건절;</p>
<p>ex)</p>
<ul>
<li>
<p>Q : 국가 코드가 'KOR’으로 되어 있는 도시의 이름을 구하시오.</p>
</li>
<li>
<p>A : SELECT Name FROM City WHERE CountryCode=‘KOR’;</p>
</li>
<li>
<p>Q : 인구가 500만 이상인 도시들의 이름을 구하시오</p>
</li>
<li>
<p>A : SELECT Name FROM City WHERE Population &gt; 5000000;</p>
</li>
</ul>
<p><strong>2. insert into 명령문</strong><br>
INSERT INTO 테이블명(컬럼명) VALUES(값);</p>
<p>ex)</p>
<p><code>주의</code> : 각각의 필드와 대응 시켜줘서 insert를 시켜주어야 한다.</p>
<p>INSERT INTO City (ID, Name, CountryCode, District, Population) values (10000, “Sample”, “KOR”, “Seoul”, 1000000);</p>
<p><code>주의</code> : 아래의 경우에는 모든 컬럼 값들이 일일히 필드와 대응되면 생략이 가능하다.</p>
<p>INSERT INTO City values(20000, &quot;SampleTest<br>
, “KOR”, “Busan”, 2000000);</p>
<p>결과 확인</p>
<p>// ID가 20000인 레코드 출력<br>
SELECT * FROM City WHERE ID = 20000;<br>
// ID가 20000인 레코드 출력<br>
SELECT * FROM City WHERE ID = 10000;</p>
<p><strong>3. update 명령문</strong><br>
UPDATE 테이블명 SET 컬럼명=값, … WHERE 조건절;</p>
<p>ex)</p>
<p>// ID가 10000인 레코드의 name을 &quot;SampleUSA&quot;로 변경<br>
UPDATE City SET Name = “SampleUSA” WHERE ID = 10000;</p>
<p>결과 확인<br>
// ID가 10000인 레코드 출력<br>
SELECT * FROM City WHERE ID = 10000;</p>
<p><strong>4. delete 명령문</strong><br>
DELETE FROM 테이블명 WHERE 조건절;</p>
<p>ex)</p>
<p>// ID가 20000이며 Population이 2000000인 레코드를 삭제<br>
DELETE FROM City WHERE (ID = 20000) AND (Population = 2000000);</p>
<p>// ID가 10000이며 Population이 1000000인 레코드를 삭제<br>
DELETE FROM City WHERE (ID = 10000) AND (Population = 1000000);</p>
<p>결과 확인</p>
<p>// ID가 10000인 레코드 출력<br>
SELECT * FROM City WHERE ID = 10000;<br>
// ID가 20000인 레코드 출력<br>
SELECT * FROM City WHERE ID = 20000;</p>
<h2 id="참고">참고</h2>
<ul>
<li><a href="https://limkydev.tistory.com/108" target="_blank" rel="noopener">[DataBase] 키(Key)의 개념 및 종류</a></li>
<li><a href="https://wkdtjsgur100.github.io/database-terms/" target="_blank" rel="noopener">데이터베이스 용어 및 기초 개념 정리(DBMS, Key관련 용어, 테이블 관련 용어 등)</a></li>
<li><a href="https://coding-factory.tistory.com/77" target="_blank" rel="noopener">[DB기초] DataBase 개념 및 용어 설명</a></li>
<li><a href="https://hojak99.tistory.com/327" target="_blank" rel="noopener">[DB] SQL 기초</a></li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2019/01/30/DatabaseBasic/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2019/01/30/Android-What-is-ConstraintLayout/"
                            aria-label=": 9일차 [안드로이드] ConstraintLayout"
                        >
                            9일차 [안드로이드] ConstraintLayout
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2019-01-30T01:05:45+09:00">
	
		    Jan 30, 2019
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    
                    
                        


                    
                    
                        <p>
                            <a
                                href="/2019/01/30/Android-What-is-ConstraintLayout/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2019/01/29/Android-MpAndroidChart/"
                            aria-label=": 8일차 [안드로이드] MpAndroidChart"
                        >
                            8일차 [안드로이드] MpAndroidChart
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2019-01-29T15:57:06+09:00">
	
		    Jan 29, 2019
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Android/">Android</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>MpAndroidChart는 그래프 라이브러리 중 하나이다. 가장 널리 알려져 있고, Github의 star가 가장 많은 그래프 라이브러리이다. 라이브러리를 선택할 때 중요하게 생각해야 할 점 중의 하나로는 <code>star</code>가 많은 것을 선택하라고 한다. 그 이유는 star가 많은 것은 그만큼 오픈 소스 라이브러리 활동이 활발하여 오류에 대한 수정이나 기능 추가 같은 활동들이 활발하기 때문이라고 한다. 그래서 나는 안드로이드에서 그래프를 그리기 위해 <strong>MpAndroidChart</strong> 라이브러리를 사용했다.</p>
<h2 id="종류">종류</h2>
<p>종류는 Github에서도 확인할 수 있듯이 엄청 다양하다. 그 중에서 나는 <strong>LineChart</strong>를 이용해서 원하는 데이터를 표현하려고 했다. 한국말로는 꺾은선 그래프라고도 하며, 이를 이용해서 데이터를 간단하게 표시할 수 있다.</p>
<p>LineaChart 말고도 다양한 그래프들이 존재한다. 예를 들면, BarChart, PieChart 등등이 있다.</p>
<h2 id="삽질-후기">삽질 후기</h2>
<p>그렇다면 내가 원하는 데이터를 그래프에 표시하기 위해서 삽질했던 후기를 정리하고자 한다.</p>
<p>##1. 데이터 생성**</p>
<p>그래프에서 표현하고자 하는 데이터를 생성해야 한다. 데이터는 <strong>Entry</strong>라고 하는 라이브러리에서 제공하는 타입으로 만들면 된다. 기본적으로 x, y의 Float(실수)형 데이터를 넣어서 만들 수 있다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Entry&gt; entires = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">entries.add(<span class="keyword">new</span> Entry(<span class="number">0</span>,<span class="number">1f</span>));</span><br><span class="line">entries.add(<span class="keyword">new</span> Entry(<span class="number">1</span>,<span class="number">2f</span>));</span><br><span class="line">entries.add(<span class="keyword">new</span> Entry(<span class="number">2</span>,<span class="number">3f</span>));</span><br><span class="line">entries.add(<span class="keyword">new</span> Entry(<span class="number">3</span>,<span class="number">4f</span>));</span><br></pre></td></tr></table></figure>
<ul>
<li>entries를 이용해 LineDataSet을 생성한다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">LineDataSet lineDataSet = <span class="keyword">new</span> LineDataSet(entries, <span class="string">"Emotion"</span>);</span><br><span class="line"><span class="comment">// entries와 지정할 label을 생성자에 넘겨준다.</span></span><br><span class="line"></span><br><span class="line">lineDataSet.setLineWidth(<span class="number">2</span>); <span class="comment">// 선 굵기</span></span><br><span class="line">lineDataSet.setCircleRadius(<span class="number">6</span>); <span class="comment">// 곡률</span></span><br><span class="line">lineDataSet.setCircleColor(ContextCompat.getColor(mContext, R.color.graphColor)); <span class="comment">// LineChart에서 Line Circle Color 설정</span></span><br><span class="line">lineDataSet.setCircleHoleColor(ContextCompat.getColor(mContext, R.color.graphColor)); <span class="comment">// LineChart에서 Line Hole Circle Color 설정</span></span><br><span class="line">lineDataSet.setColor(ContextCompat.getColor(mContext, R.color.graphColor)); <span class="comment">// LineChart에서 Line Color 설정</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 그리고 기타 설정 등도 할 수 있다.</span></span><br></pre></td></tr></table></figure>
<ul>
<li>LineDataSet을 담는 LineData를 만들어준다. 여러 개의 라인 데이터가 들어갈 수 있다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LineData lineData = <span class="keyword">new</span> LineData(lineDataSet);</span><br><span class="line"><span class="comment">// 라인 데이터의 텍스트 컬러 / 사이즈를 설정할 수 있다.</span></span><br><span class="line"><span class="comment">// 물론 나는 사용하지 않았다.</span></span><br><span class="line">lineData.setValueTextColor(ContextCompat.getColor(getContext(), R.color.black));</span><br><span class="line">lineData.setValueTextSize(<span class="number">9</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>또한, 추가적으로 x축, y축에 대한 label과 텍스트, 갯수 등을 설정할 수 있다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// x축 설정</span></span><br><span class="line">view.setLineData(lineData);</span><br><span class="line">xAxis = view.getXAxis(); <span class="comment">// x축에 대한 정보를 View로부터 받아온다.</span></span><br><span class="line">xAxis.setPosition(XAxis.XAxisPosition.BOTTOM); <span class="comment">// x축 표시에 대한 위치 설정으로 아래쪽에 위치시킨다.</span></span><br><span class="line">xAxis.setTextColor(R.color.black); <span class="comment">// x축 텍스트 컬러 설정</span></span><br></pre></td></tr></table></figure>
<ul>
<li>y축에 대한 설정은 왼쪽과 오른쪽 따로 제공하고 있기 때문에 각각 가져와서 사용하지 않는 방향은 비활성화 하는 것이 좋다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// y축 설정</span></span><br><span class="line"></span><br><span class="line">yLAxis = view.getYLeftAxis(); <span class="comment">// y축 왼쪽 데이터 가져오기.</span></span><br><span class="line">yLAxis.setTextColor(R.color.black); <span class="comment">// y축 텍스트 컬러 설정</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// y축 오른쪽 비활성화</span></span><br><span class="line">yRAxis = view.getYRightAxis();</span><br><span class="line">yRAxis.setDrawLabels(<span class="keyword">false</span>);</span><br><span class="line">yRAxis.setDrawAxisLine(<span class="keyword">false</span>);</span><br><span class="line">yRAxis.setDrawGridLines(<span class="keyword">false</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>위에는 기본적인 설정과 같다. 그리고 구글에 검색하면 쉽게 찾아볼 수 있는 글이다. 이제 x축과 y축을 사용하고 싶은 데이터로 custom하게 사용하는 방법을 정리하려고 한다.</li>
<li>먼저, x축에 내가 원하는 요일들을 설정하기 위해서 아래와 같은 클래스를 만들어준다. IAxisValueFormatter 인터페이스를 구현한다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GraphAxisValueFormatter</span> <span class="keyword">implements</span> <span class="title">IAxisValueFormatter</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String[] mValues;</span><br><span class="line">    <span class="comment">// 생성자 초기화</span></span><br><span class="line">    GraphAxisValueFormatter(String[] values)&#123;</span><br><span class="line">        <span class="keyword">this</span>.values = values;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFormattedValue</span><span class="params">(<span class="keyword">float</span> value, AxisBase axis)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mValues[(<span class="keyword">int</span>) value];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>위와 같은 클래스를 만든다. 그리고 아래와 같이 custom 클래스를 지정하여줌으로써 x축의 데이터를 재가공한다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xAxis.setValueFormatter(<span class="keyword">new</span> GraphAxisValueFormatter(mDays));</span><br><span class="line"><span class="comment">// mDays는 요일을 가지고 있는 String 배열</span></span><br></pre></td></tr></table></figure>
<ul>
<li>그렇다면 y축의 데이터를 재가공하기 위해서는 어떻게 하면될까?? 방법은 x축과 똑같다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GraphYAxisValueFormatter</span> <span class="keyword">implements</span> <span class="title">IAxisValueFormatter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String[] mEmojis;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 생성자 초기화</span></span><br><span class="line">    GraphYAxisValueFormatter(String[] values) &#123;</span><br><span class="line">        <span class="keyword">this</span>.mEmojis = values;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFormattedValue</span><span class="params">(<span class="keyword">float</span> value, AxisBase axis)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mEmojis[(<span class="keyword">int</span>) value];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>y축의 데이터를 재가공하기 위해서 custom하게 만든 클래스를 지정하면 된다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yLAxis.setValueFormatter(<span class="keyword">new</span> GraphYAxisValueFormatter(mEmojis));</span><br><span class="line"><span class="comment">// mEmojis는 이모지를 가지고 있는 배열</span></span><br></pre></td></tr></table></figure>
<p><strong>2. y축 데이터 재가공</strong></p>
<ol>
<li>
<p>y축에 icon 삽입<br>
y축의 데이터를 재가공 하기 위해서 일단 y축의 이미지를 넣어야 한다는 생각으로 접근을 했다. 그래서 구글링을 통해서 MpAndroidChart에 이미지 혹은 icon을 삽입한 그래프를 찾아보았다. 일단, LineChart는 찾아볼 수 없었고, BarChart, PieChart에서는 손가락 안에 꼽을 수 있을 정도로 발견할 수 있었다.</p>
</li>
<li>
<p>라이브러리 커스텀<br>
그래서 라이브러리를 파헤쳐서 커스텀을 해보자는 마음을 먹었다. (어리석은 생각이었다.) 그래서 BarChart를 통해 이미지를 넣은 것을 보고 이를 토대로 LineChart를 커스텀하기로 마음을 먹었지만, LineChart에서는 이미지를 그릴 수 있는 메소드를 찾지 못했다.</p>
</li>
<li>
<p>y축 데이터에 이모지에 대한 유니코드 삽입<br>
두 개의 방법이 실패하고 제일 처음 생각했지만, 위에서 언급하지 않았던 방법인 이모지에 대한 유니코드 값을 넣어서 간단하게 구현해보는 방법이다. 처음에 이모지에 대한 유니코드를 넣어서 확인해보았는데, 적용이 되지 않아서 실패라고 생각을 했었다. 하지만, 갓자이너 여자친구의 도움으로 다른 사이트를 알았다.</p>
</li>
</ol>
<p>이 사이트에서 이모지에 대한 유니코드 값을 얻어서 그래프의 y축에 데이터를 재가공하였더니 이모지가 정상적으로 들어가는 것을 확인할 수 있었다. :)</p>
<p><strong>3. 중복과 간격 문제</strong></p>
<p>위의 2번까지의 과정을 해결하고 나니 내가 원하는 데이터로 재가공하여 그래프를 표현할 수 있게 되었다. 하지만, y축의 이모지 데이터가 중복해서 나오는 현상을 마주하게 되었다…</p>
<p>이 문제는 도대체 왜 그러는 것일까라는 의문을 가지고 구글링을 하고 커스텀을 위한 Class에서 return 하기 전에 로그 값을 찍는데 value가 float이라서 <strong>int</strong>로 캐스팅하는 과정에서 값이 손실되어서 같은 인덱스가 여러 번 참조되어 중복되는 것이라고 판단을 하게 되었다.</p>
<p>그래서 이를 해결할 수 있는 방법이 무엇이 있을까 생각해보고 이 라이브러이의 <code>issue</code> 탭에서 실마리를 찾아보고자 했다. 아니나 다를까 비슷한 문제를 직면한 사람을 찾을 수 있었다. 또한, 이에 대한 답변도 존재했다.</p>
<p>답변은 다음과 같았다. y축의 Max / Min 값을 지정하고 증가 간격(세분성) 설정을 true로 지정하고 세분 간격을 1.0f로 설정해주었다. 그리고 빌드를 해보니 내가 원하는 것처럼 이모지가 하나씩 증가하면서 나타나는 것을 확인할 수 있었다.</p>
<h2 id="느낀점">느낀점</h2>
<p>외부 라이브러리를 사용할 때는 정말로 star가 많은 것을 사용하자. 분명 내가 직면한 문제를 먼저 경험한 개발자들이 있을 것이다. issue 탭에서 문제와 답을 찾을 수 있으니 포기는 휴지통에 버리자.</p>
<h2 id="참고">참고</h2>
<ul>
<li><a href=""></a></li>
<li><a href=""></a></li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2019/01/29/Android-MpAndroidChart/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2019/01/26/Java-Singleton-Pattern/"
                            aria-label=": 6일차 [Java] Singleton"
                        >
                            6일차 [Java] Singleton
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2019-01-26T12:52:38+09:00">
	
		    Jan 26, 2019
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Java/">Java</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>싱글톤 패턴을 사용함에 있어서 효율적인 holder에 의한 방식을 사용해서 구현했는데, 이 방법이 나오기까지 전의 방법들을 까먹어서 설명하기 힘들었다. 그래서 다시 상기하고자 간단하게 정리를 하려고 한다.</p>
<p>이전에 정리한 <a href="https://woovictory.github.io/2019/01/04/Android-What-is-Singleton-Pattern/">싱글톤 패턴</a>에 관한 글이 궁금하다면 참고하면 좋겠다.</p>
<h2 id="1-eager-initialization이른-초기화-방식">1. Eager initialization(이른 초기화 방식)</h2>
<p>Singleton의 가장 기본적인 Eager initialization 방식이다. 먼저, 클래스 내에 전역 변수로 instance 변수를 생성하고 private static을 사용하여 인스턴스화에 상관없이 접근이 가능하면서 동시에 private 접근 제어 키워드를 사용해 <code>EageInitialization.instance</code>로 바로 접근 할 수 없도록 한다.</p>
<p>또, 생성자에도 pirvate 접근 제어 키워드를 붙여 다른 클래스에서 new EageInitialization(); 방식으로 새로운 인스턴스를 생성하는 것을 방지한다. 오로지 정적 메소드인 getInstance() 메소드를 이용해서 인스턴스를 접근하도록 하여 유일무이한 동일 인스턴스를 사용하는 기본 싱글톤 원칙을 지키게 한다.</p>
<p>이른 초기화 방식은 싱글톤 객체를 미리 생성해 놓는 방식이다. 항상 싱글톤 객체가 필요하거나 객체 생성 비용이 크게 들어가지 않는 경우에 사용한다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EagerInitialization</span></span>&#123;</span><br><span class="line">    <span class="comment">// private static으로 선언(전역 변수)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> EagerInitialization instance = <span class="keyword">new</span> EagerInitialization();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// private한 생성자</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">EagerInitialization</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> EagerInitialization <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>장점 : static으로 생성된 변수에 싱글톤 객체를 선언했기 때문에 클래스 로더에 의해 클래스가 로딩될 때 싱글톤 객체가 생성된다. 또 클래스 로더에 의해 클래스가 최초 로딩될 때 객체가 생성됨으로 Thread-safe하다.</li>
<li>단점 : 싱글톤 객체 사용 유무와 관계 없이 클래스가 로딩되는 시점에 항상 싱글톤 객체가 생성되고, 메모리를 잡고 있기 때문에 비효율적이다.</li>
</ul>
<h2 id="2-lazy-initialization늦은-초기화-방식">2. Lazy initialization(늦은 초기화 방식)</h2>
<p>Eager initialization(이른 초기화 방식)과 정반대로 클래스가 로딩되는 시점이 아닌 클래스의 인스턴스가 사용되는 시점에서 싱글톤 인스턴스를 생성한다. 즉, 사용 시점까지 싱글톤 객체 생성을 미루기 때문에 사용하기 전까지 메모리를 점유하지 않는다. <code>getInstacne()</code> 메소드 안에서 instance가 null인 경우에만 new LazyInitialization()으로 싱글톤 객체를 할당한다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LazyInitialization</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> LazyInitialization instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 생성자</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">LazyInitialization</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LazyInitialization <span class="title">getInstanc</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="keyword">null</span>)&#123;</span><br><span class="line">            intance = <span class="keyword">new</span> LazyInitialization();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>장점 : 싱글톤 객체가 필요할 때 인스턴스를 얻을 수 있다. Eager initialization 방식의 단점을 보완한 수 있다.(메모리 누수!)</li>
<li>단점 : 만약 multi-thread 환경에서 어려 곳에서 동시에 getInstance() 메소드를 호출할 경우 인스턴스가 두 번 생성될 여지가 있다. 즉, multi-thread 환경에서는 싱글톤 철학이 깨질 수 있는 위험이 있다.</li>
</ul>
<h2 id="3-thread-safe-lazy-initializtion스레드-안전-늦은-초기화">3. Thread safe Lazy initializtion(스레드 안전 늦은 초기화)</h2>
<p>Lazy initializtion 방식에서는 multi-thread 환경에서 thread-safe 하지 않다는 단점을 보완하기 위해서 멀티 스레드에서 스레드들이 동시 접근하는 동시성을 <code>synchronized</code> 키워드를 이용해 해결한다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ThreadSafeLazyInitialization&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadSafeLazyInitialization intance;</span><br><span class="line">    <span class="comment">// 생성자</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">ThreadSafeLazyInitialization</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> ThreadSafeLazyInitialization <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="keyword">null</span>)&#123;</span><br><span class="line">            intance = <span class="keyword">new</span> ThreadSafeLazyInitialization();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>장점 : 위에서 언급한 듯이 Lazy initialization 방식에서 thread-safe 하지 않은 점을 보완한다.</li>
<li>단점 : synchronized 키워드를 사용할 경우 자바 내부적으로 해당 영역이나 메소드를 lock, unlock 처리하기 때문에 많은 cost가 발생한다. 대략 100배 정도 비효율적이라고 한다. 따라서 많은 thread들이 getInstance()를 호출하게 되면 프로그램 전반적인 성능 저하가 발생한다.</li>
</ul>
<h2 id="3-1-thread-safe-lazy-initialization-double-checked-locking-기법">3-1. Thread safe Lazy initialization + Double-checked locking 기법</h2>
<p>위에서 Thread safe Lazy initialization을 보았다. 많은 스레드들이 동시에 synchronized 처리된 메소드를 접근하면 성능저하가 발생된다고 했다. 이를 좀 더 완화하기 위해서 Double-checked locking 기법을 사용한다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadSafeLazyInitialization</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadSafeLazyInitialization instance;</span><br><span class="line">    <span class="comment">// 생성자</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">ThreadSafeLazyInitialization</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ThreadSafeLazyInitialization <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// Double-checked locking</span></span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (ThreadSafeLazyInitialization.class)&#123;</span><br><span class="line">                <span class="keyword">if</span>(instance == <span class="keyword">null</span>)&#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> ThreadSafeLazyInitialization();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>첫 번째 if문에서 instance가 null인 경우 synchronized 블록에 접근하고 한 번 더 if문으로 instance가 null인지 유무를 체크한다. 2번 모두 다 instance가 null인 경우에 new를 통해 인스턴스화 시킨다. 그 후에 instance가 null이 아니기 때문에 synchronized 블록을 타지 않는다. 이런 DCL 기법을 통해 성능 저하를 보완할 수 있다.</li>
</ul>
<h2 id="4-initialization-on-demand-holder-idiomholder에-의한-초기화">4. Initialization on demand holder idiom(holder에 의한 초기화)</h2>
<p>이 방법은 클래스 안에 클래스(Holder)를 두어 JVM의 Class Loader 매커니즘과 Class가 로드되는 시점을 이용한 방법이다. Lazy initialization 방식을 가져가면서 Thread간 동기화 문제를 동시에 해결할 수 있다.</p>
<p>로직은 InitializationOnDemandHolderIdiom 클래스에는 SingleTonHolder 클래스의 변수가 없기 때문에 InitializationOnDemandHolderIdiom 로딩시 SingleTonHolder 클래스를 초기화하지 않는다.</p>
<p>중첩 클래스(static으로 선언됨.) SingleTonHolder는 getInstance 메소드가 호출되기 전에는 참조되지 않으며, 최초로 getInstance() 메소드가 호출될 때  SingleTonHolder.instance를 참조하는 순간 클래스 로더에 의해 Class가 로딩되며 초기화되며, 싱글톤 객체를 생성하여 리턴한다.</p>
<p>또한, SingleTonHolder 안에 선언된 instance가 static이기 때문에 클래스 로딩 시점에 한 번만 호출된다. 그리고 final을 사용하기 때문에 다시 값이 할당되지 않도록 한다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InitializationOnDemandHolderIdiom</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> InitializationOnDemandHolderIdiom instante;</span><br><span class="line">    <span class="comment">// 생성자</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">InitializationOnDemandHolderIdiom</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleTonHolder</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> InitializationOnDemandHolderIdiom INSTANCE = <span class="keyword">new</span> InitializationOnDemandHolderIdiom();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> InitializationOnDemandHolderIdiom <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SingleTonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>현재까지 가장 많이 사용되는 방법으로 알려져 있다. 그만큼 지금까지 나온 방법 중 가장 효율적인 방법이라고 한다.</li>
</ul>
<h2 id="참고">참고</h2>
<ul>
<li><a href="https://limkydev.tistory.com/67" target="_blank" rel="noopener">[Design_Pattern] Singleton(싱글톤)의 고도화</a></li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2019/01/26/Java-Singleton-Pattern/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2019/01/25/Android-Room-Basic/"
                            aria-label=": 5일차 [안드로이드] Room"
                        >
                            5일차 [안드로이드] Room
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2019-01-25T16:08:11+09:00">
	
		    Jan 25, 2019
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Android/">Android</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>[2020.02.11 기준으로 수정과 동시에 내용을 추가하고 있습니다.]<br>
[2020.03.27 기준으로 글을 새롭게 작성하고 있습니다. 따라서 새로 작성되는 포스팅이 완료되면 해당 포스팅은 삭제될 예정입니다.]<br>
작성중인 글 : <a href="https://woovictory.github.io/2020/03/27/Android-Room-Concept/">Room 개념편</a><br>
[2020.04.25 기준 홍보 내용 추가]<br>
현재 신입 개발자를 위한 Repository를 운영하고 있습니다. <a href="https://github.com/WooVictory/Ready-For-Tech-Interview" target="_blank" rel="noopener">💻 신입 개발자로서 준비를 하기 위해 지식을 정리하는 공간 👨‍💻</a>이며, 운영체제, 자바, 네트워크, 데이터베이스 등의 내용이 정리되어 있습니다. 계속해서 꾸준히 추가 중이니 한번씩 들러서 봐주시면 감사하겠습니다. 또한, 도움이 된다면 Star를 꾹~ 눌러주시면 저에게 큰 힘이 됩니다 :)</p>
<p>Android Architecture Component 중 하나인 Room에 대해 알아보려고 한다.</p>
<h3 id="orm">[ORM]</h3>
<p>Room을 알아보기 전에 ORM이 무엇인지 살펴보자. ORM이란 Object Relational Mapping으로 데이터베이스와 객체 지향 프로그래밍 언어간의 호환되지 않는 데이터를 변환하는 프로그래밍 기법으로 <strong>DB 테이블과 매핑되는 객체를 만들고 그 객체에서 DB를 관리하는 것이다.</strong></p>
<h3 id="room">[Room]</h3>
<p>Room은 SQLite의 기능을 최대한 활용하는 동시에 데이터베이스를 원활하게 접근할 수 있도록 SQLite 위에 추상화 계층을 제공 라이브러리라고 생각하면 된다.</p>
<ul>
<li>적은 양의 정형화된 데이터를 처리하는 애플리케이션은 로컬에서 해당 데이터를 유지함으로써 큰 이점을 얻을 수 있다.
<ul>
<li>ex) 관련 데이터를 캐시하는 것</li>
</ul>
</li>
<li>이렇게 하면 장치가 네트워크에 액세스할 수 없는 경우에도 사용자가 오프라인 상태일 때 해당 콘텐츠를 계속 탐색할 수 있다. 이후에 장치가 다시 온라인 상태가 되면 사용자가 시작한 모든 콘텐츠 변경 내용이 서버에 동기화된다.</li>
</ul>
<h3 id="사용해보기">[사용해보기]</h3>
<ol>
<li>gradle에 의존성을 추가한다.</li>
</ol>
<ul>
<li><strong>먼저, build.gradle 파일의 dependencies에 추가해준다.그래야지 Room을 사용할 수 있다.</strong></li>
<li>roomVersion은 사용하는 시점에 맞는 버전을 사용하면 된다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//room</span></span><br><span class="line">implementation <span class="string">"android.arch.persistence.room:runtime:$roomVersion"</span></span><br><span class="line">kapt <span class="string">"android.arch.persistence.room:compiler:$roomVersion"</span></span><br></pre></td></tr></table></figure>
<h3 id="3가지-주요-컴포넌트">[3가지 주요 컴포넌트]</h3>
<p>Room은 엔티티(Entity), 데이터 접근 객체(Data Access Object), 룸 데이터 베이스(Room Database) 이렇게 총 3가지 구성요소로 나뉜다.</p>
<ol>
<li><strong>Database</strong></li>
</ol>
<ul>
<li>데이터베이스 홀더를 포함하고 앱의 지속적이고 관계가 있는 데이터에 대한 기본 연결을 위한 기본 액세스 지점 역할을 한다.</li>
<li><code>@Database</code>로 어노테이션된 클래스는 다음의 조건을 만족해야 한다.
<ul>
<li><strong>RoomDatabase</strong>를 상속받는 클래스는 추상 클래스이어야 한다.</li>
<li>어노테이션 내에 데이터베이스와 연관된 (즉, 데이터베이스에 들어갈 테이블) 엔티티의 목록을 포함한다.</li>
<li>파라미터가 0개인 추상 메소드를 포함하고 @Dao로 어노테이션된 클래스를 반환한다.</li>
</ul>
</li>
<li>런타임에 <code>Room.databaseBuilder() 또는 Room.inMemoryDatabaseBuilder()</code>를 호출하여 데이터베이스 인스턴스를 얻을 수 있다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// User and Book are classes annotated with @Entity.</span></span><br><span class="line"><span class="meta">@Database</span>(version = <span class="number">1</span>, entities = &#123;User.class, Book.class&#125;)</span><br><span class="line"><span class="function"><span class="keyword">abstract</span> class AppDatabase extends <span class="title">RoomDatabase</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// BookDao is a class annotated with @Dao. </span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">public</span> BookDao <span class="title">bookDao</span><span class="params">()</span></span>; </span><br><span class="line">    <span class="comment">// UserDao is a class annotated with @Dao. </span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">public</span> UserDao <span class="title">userDao</span><span class="params">()</span></span>; </span><br><span class="line">    <span class="comment">// UserBookDao is a class annotated with @Dao. </span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">public</span> UserBookDao <span class="title">userBookDao</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>데이터베이스에서 쿼리를 직접 실행하는 대신 Dao 클래스를 만드는 것이 좋다. Dao 클래스를 사용하면 보다 논리적인 계층에서 데이터베이스 통신을 추상화할 수 있다. 이 계층은 직접 sql 쿼리를 실행하는 것에 비해 테스트를 더 쉽게 할 수 있다.</li>
<li>Room은 애플리케이션이 컴파일 되는 동안 Dao 클래스의 모든 쿼리를 확인하여 쿼리 중 문제가 있는 경우 즉시 사용자에게 알려준다.</li>
</ul>
<ol start="2">
<li><strong>Entity</strong></li>
</ol>
<ul>
<li>데이터베이스 내에서 테이블을 나타낸다.</li>
<li>room을 사용할 때 관련 필드 집합을 엔티티들로 정의한다.</li>
<li>각 엔티티에 대해 항목(아이템)을 보관하기 위해 연결된 데이터베이스 객체 내에 테이블이 생성된다.</li>
<li>데이터베이스 클래스의 엔티티 array를 통해 엔티티 클래스를 참조해야 한다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="meta">@PrimaryKey</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String firstName;</span><br><span class="line">    <span class="keyword">public</span> String lastName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>필드를 유지하려면, 룸은 필드에 접근할 수 있어야 한다.</li>
<li>필드를 public으로 만들거나, getter / setter를 제공할 수 있다.</li>
<li>getter / setter method를 사용한다면 룸에서 JavaBeans 규칙을 기반으로 한다.[멤버 변수는 private형을 지정하여 선언한다.]</li>
</ul>
<blockquote>
<p>주의</p>
</blockquote>
<p>엔티티에는 빈 생성자 (해당 DAO 클래스가 각 지속 필드를 액세스할 수 있는 경우) 또는 매개 변수에 엔티티 필드와 일치하는 유형과 이름이 포함된 생성자가 있을 수 있다. 룸은 일부 필드만 수신하는 생성자와 같이 전체 또는 부분 생성자를 사용할 수도 있다.</p>
<p><strong>User a Primary Key</strong></p>
<ul>
<li>각 Entity는 최소 하나 이상의 필드를 기본키로 지정해야 한다.</li>
<li>필드가 하나만 있는 경우에도 <code>@PrimaryKey</code> 어노테이션을 사용하여 필드에 주석을 달 필요가 있다.</li>
<li>또한, 룸에서 엔티티에 자동으로 ID를 할당하도록 하려면 @PrimaryKey의 <strong>autoGenerate</strong> 속성을 설정할 수 있다.(기본은 false. ex: index가 자동으로 증가하는 경우와 같은)</li>
<li>엔티티가 복합 PrimaryKey가 있는 경우 @Entity 어노테이션의 <strong>primaryKeys</strong> 속성을 사용할 수 있다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span>(primaryKeys = &#123;<span class="string">"firstName"</span>, <span class="string">"lastName"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String firstName;</span><br><span class="line">    <span class="keyword">public</span> String lastName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>기본적으로 룸은 클래스 이름을 데이터베이스 테이블 이름으로 사용한다.</li>
<li>만약 테이블이 다른 이름을 가지게 하고 싶다면, @Entity 어노테이션의 <strong>tableName</strong> 속성을 설정하면 된다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span>(tableName = <span class="string">"users"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>주의 : SQLite의 테이블 이름은 대소문자를 구분하지 않는다.</p>
</blockquote>
<ul>
<li>tableName 속성과 비슷하게 룸은 필드 이름을 데이터베이스의 column 이름으로 사용한다.</li>
<li>만약 column 이름을 다르게 하고 싶다면 <code>@ColumnInfo</code> 어노테이션을 추가하면 된다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span>(tableName = <span class="string">"users"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="meta">@PrimaryKey</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ColumnInfo</span>(name = <span class="string">"first_name"</span>)</span><br><span class="line">    <span class="keyword">public</span> String firstName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ColumnInfo</span>(name = <span class="string">"last_name"</span>)</span><br><span class="line">    <span class="keyword">public</span> String lastName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Ignore fields</strong></p>
<ul>
<li>기본적으로 룸은 엔티티에 정의된 각 필드에 대한 Column을 생성한다.</li>
<li>엔티티에 지속하고 싶지 않은 필드가 있는 경우 <code>@Ignore</code>를 사용하여 필드에 어노테이션을 추가할 수 있다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span>(tableName = <span class="string">"users"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="meta">@PrimaryKey</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String firstName;</span><br><span class="line">    <span class="keyword">public</span> String lastName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Ignore</span></span><br><span class="line">    Bitmap picture;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>상위 엔티티에서 필드를 상속하는 경우, 일반적으로 @Entity 특성의 <strong>ignoredColumns</strong> 속성을 더 쉽게 추가해서 사용할 수 있다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span>(ignoredColumns = <span class="string">"picture"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RemoteUser</span> <span class="keyword">extends</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="meta">@PrimaryKey</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> hasVpn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Provide table search support</strong></p>
<p>추가 예정~~</p>
<ol start="3">
<li><strong>DAO(Data Access Object)</strong></li>
</ol>
<ul>
<li>데이터베이스에 접근할 수 있는 메소드를 포함하며, 데이터 접근 객체이다.</li>
<li>인터페이스로서 쿼리를 사용하는 메소드를 정의한다.</li>
<li>룸을 사용해 앱의 데이터에 접근하려면 DAO를 사용한다.</li>
<li>각 DAO에는 앱의 데이터베이스에 대한 추상적 액세스를 제공하는 방법이 포함되어 있으므로(interface내에 쿼리와 함께 함수만 정의) 이 Dao 객체들은 룸의 주요 구성요소를 형성한다.</li>
<li>쿼리 builder나 직접적인 쿼리 대신 DAO 클래스를 사용하여 데이터베이스에 접근하여 데이터베이스 구조의 다양한 구성 요소를 분리할 수 있다.</li>
<li>또한, DAO를 사용하면 애플리케이션을 테스트할 때 데이터베이스 접근을 쉽게 할 수 있다.</li>
<li>DAO는 인터페이스 또는 추상 클래스일 수 있다.
<ul>
<li>추상 클래스인 경우 선택적으로 RoomDatabase를 유일한 매개 변수로 사용하는 생성자를 가질 수 있다.</li>
<li>Room은 <strong>Compile time</strong>에 각 DAO 구현을 생성한다.</li>
</ul>
</li>
</ul>
<p><strong>Define methods for convenience</strong></p>
<ul>
<li>DAO 클래스를 사용하여 나타낼 수 있는 여러가지 편리한 쿼리가 있다.</li>
</ul>
<p><strong>1. Insert</strong></p>
<ul>
<li>DAO 메소드를 작성하고 @Insert로 어노테이션을 지정할 때, Room은 단일 트랜잭션의 데이터베이스에 모든 매개변수를 삽입하는 구현을 생성한다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Dao</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyDao</span></span>&#123;</span><br><span class="line">    <span class="meta">@Insert</span>(onConflict = OnConflictStrategy.REPLACE)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertUsers</span><span class="params">(User... users)</span></span>;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Insert</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertBothUsers</span><span class="params">(User user1, User user2)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Insert</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertUsersAndFriends</span><span class="params">(User user, List&lt;User&gt; friends)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>@Insert 메소드는 매개 변수를 1개만 받으면 삽입된 항목의 새 rowId인 long 타입의 값을 반환할 수 있다. 매개변수가 배열 또는 집합인 경우 Long[] 또는 List<long>을 대신 반환해야 한다.</long></li>
<li>@Insert에 <code>onConflict</code> 속성을 지정할 수 있다.  테이블에 Entity를 삽입할 때 같은 값인 경우, <strong>충돌</strong>이 발생하는데 이 충돌을 어떻게 해결할지를 정의할 수 있다.
<ul>
<li>위에서는 Replace로 지정하여 충돌 발생 시 새로 들어온 데이터로 교체한다.</li>
</ul>
</li>
</ul>
<p><strong>2. update</strong></p>
<ul>
<li><code>update</code> 방법은 테이터베이스에서 매개 변수로 지정된 엔티티 집합을 수정한다. 각 엔티티의 기본 키와 일치하는 조회를 사용한다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Dao</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Update</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUsers</span><span class="params">(User... users)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>일반적으로 필요하진 않지만, update를 사용하면 데이터베이스에서 업데이트된 행 수를 나타내는 int 값을 반환할 받을 수 있다.</li>
</ul>
<p><strong>3. Delete</strong></p>
<ul>
<li><code>Delete</code> 방법은 매개 변수로 지정된 엔티티 집합을 데이터베이스에서 제거한다. 기본키를 사용하여 삭제할 엔티티를 찾는다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Dao</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyDao</span></span>&#123;</span><br><span class="line">    <span class="meta">@Delete</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteusers</span><span class="params">(User... users)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>update와 비슷하게 삭제를 하면 데이터베이스에서 제거된 행 수를 나타내는 int 값을 반환할 수 있다.</li>
</ul>
<p><strong>4. Query</strong></p>
<ul>
<li><code>@Query</code>는 DAO 클래스에서 사용되는 주석이다.</li>
<li>데이터베이스에서 읽기 / 쓰기 작업을 수행할 수 있다.</li>
<li>각 @Query 메소드는 Compile time에 확인되므로 쿼리에 문제가 있으면 Runtim Error 대신 <code>Compile Error</code>가 발생한다.</li>
<li>또한, 룸은 반환된 객체의 필드 이름이 쿼리 응답의 해당 열 이름과 일치하지 않는 경우 룸은 다음 두 가지 방법 중 하나로 경고를 표시한다.
<ul>
<li>일부 필드 이름만 일치하는 경우 경고를 표시한다.</li>
<li>필드 이름이 일치하지 않으면 오류가 발생한다.</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Dao</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyDao</span></span>&#123;</span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"SELECT * FROM user"</span>)</span><br><span class="line">    <span class="keyword">public</span> User[] loadAllUsers();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>모든 사용자를 load하는 간단한 쿼리이다.</li>
<li>Compile time에 룸은 사용자 테이블의 모든 Column을 쿼리한다는 것을 알고 있다. 쿼리에 구문 오류가 있거나 사용자 테이블이 데이터베이스에 없는 경우, Room은 앱 컴파일 시 적절한 메시지가 포함된 오류를 표시한다.</li>
</ul>
<p><strong>5. Passing parameters into the query</strong></p>
<ul>
<li>대부분의 경우 특정 연령보다 나이가 많은 사용자만 표시하는 등의 필터링 작업을 수행하려면 매개 변수를 쿼리에 전달해야 한다.</li>
<li>다음에서 확인할 수 있다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Dao</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyDao</span></span>&#123;</span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"SELECT * FROM user WHERE age &gt; :minAge"</span>)</span><br><span class="line">    <span class="keyword">public</span> User[] loadAllUsersOlderThan(<span class="keyword">int</span> minAge);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>이 쿼리를 컴파일할 때, Room은 :minAge bind 매개 변수와 minAge 메소드 매개변수를 일치시킨다. Room은 매개 변수 이름을 사용하여 매치를 수행한다. 일치하지 않는 경우 앱 컴파일 시 오류가 발생한다.</li>
<li>다음과 같이 여러 매개변수를 전달하거나 조회에서 여러 번 참조할 수도 있다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Dao</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"SELECT * FROM user WHERE age BETWEEN :minAge AND :maxAge"</span>)</span><br><span class="line">    <span class="keyword">public</span> User[] loadAllUsersBetweenAges(<span class="keyword">int</span> minAge, <span class="keyword">int</span> maxAge);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"SELECT * FROM user WHERE first_name LIKE :search "</span> +</span><br><span class="line">           <span class="string">"OR last_name LIKE :search"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findUserWithName</span><span class="params">(String search)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>6. Returning subsets of columns</strong></p>
<ul>
<li>대부분의 경우 엔티티의 몇 가지 필드만 있으면 된다.</li>
<li>예를 들어 UI는 사용자에 대한 모든 세부 정보가 아니라 사용자의 성과 이름만 표시할 수 있다. 앱의 UI에 표시되는 열만 가져오면 리소스가 절약되고 쿼리가 더 빨리 완료된다.</li>
<li>Room을 사용하면 결과 Column 집합을 반환될 개체로 매핑할 수 있는 쿼리에서 Java 기반 개체를 반환할 수 있다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java Object</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NameTuple</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ColumnInfo</span>(name = <span class="string">"first_name"</span>)</span><br><span class="line">    <span class="keyword">public</span> String firstName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ColumnInfo</span>(name = <span class="string">"last_name"</span>)</span><br><span class="line">    <span class="keyword">public</span> String lastName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Query 메소드에서 이 자바 객체를 사용할 수 있다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Dao</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyDao</span></span>&#123;</span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"SELECT first_name, last_name FROM user"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;NameTuple&gt; <span class="title">loadFullName</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Room은 쿼리가 first_name, last_name 열에 대한 값을 반환하고 이러한 값을 NameTuple 클래스의 필드에 매핑할 수 있음을 이해한다.</li>
<li>따라서 룸에서 적절한 코드를 생성할 수 있다.</li>
<li>쿼리가 너무 많은 열을 반환하거나 NameTuple 클래스에 없는 열을 반환하면 룸에 경고가 표시된다.</li>
</ul>
<p><strong>7. Passing a collection of arguments</strong></p>
<ul>
<li>일부 쿼리는 런타임까지 알 수 없는 정확한 수의 매개 변수를 사용하여 많은 매개 변수를 전달해야 할 수 있다.</li>
<li>예를 들어, regions의 하위 집합에서 모든 사용자에 대한 정보를 검색할 수 있다.</li>
<li>Room은 매개변수가 집합을 나타내는 시점을 파악하고 제공된 매개변수 수에 따라 런타임에 매개변수를 자동으로 확장한다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Dao</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"SELECT first_name, last_name FROM user WHERE region IN (:regions)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;NameTuple&gt; <span class="title">loadUsersFromRegions</span><span class="params">(List&lt;String&gt; regions)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>8. Observable queries</strong></p>
<ul>
<li>쿼리를 수행하며 데이터가 변경될 때 앱의 UI가 자동으로 업데이트 되는 경우가 많다.</li>
<li>이를 수행하기 위해서는 쿼리 메소드 description에 <strong>LiveData</strong> 유형의 반환 값을 사용한다.</li>
<li>Room은 데이터베이스가 업데이트될 때 LiveData를 업데이트하는데 필요한 모든 코드를 생성한다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Dao</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyDao</span></span>&#123;</span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"SELECT first_name, last_name FROM user WHEHE region IN (:regions)"</span>)</span><br><span class="line">    <span class="keyword">public</span> LiveData&lt;List&lt;User&gt;&gt; loadUserFromRegionsSync(List&lt;String&gt; regions);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>9. Reactive queries with RxJava</strong></p>
<p>추가 예정~~</p>
<h3 id="연습해보기">[연습해보기]</h3>
<ul>
<li><code>Entity</code> : database의 row와 mapping되는 class. 즉, table의 구조를 나타내는데 Database에서 <strong>entities</strong> 함수를 통해 접근할 수 있다.</li>
</ul>
<p>@Ignore를 붙이지 않는한 DB에 지속적으로 유지된다.<br>
entity는 empty 생성자나, 부분 field만 갖는 생성자, full field에 대한 생성자 모두를 가질 수 있다.</p>
<ul>
<li><code>DAO</code> : database를 접근하는 함수들이 정의되는 class or interface이다. @Database로 정의된 class는 내부에 인자가 없고 @Dao annotation이 되어 있는 class를 return하는 abstract 함수를 포함하고 있다.</li>
</ul>
<p>아래의 예제는 하나의 entity와 하나의 Dao를 갖는 형태이다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// User.java</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="meta">@PrimaryKey</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> uid;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ColumnInfo</span>(name = <span class="string">"first_name"</span>)</span><br><span class="line">    <span class="keyword">private</span> String firstName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ColumnInfo</span>(name = <span class="string">"last_name"</span>)</span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 생략</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UserDao.java</span></span><br><span class="line"><span class="meta">@Dao</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span></span>&#123;</span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"SELECT * FROM user"</span>) </span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">getAll</span><span class="params">()</span></span>; </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"SELECT * FROM user WHERE uid IN (:userIds)"</span>) </span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">loadAllByIds</span><span class="params">(<span class="keyword">int</span>[] userIds)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"SELECT * FROM user WHERE first_name LIKE :first AND "</span> + <span class="string">"last_name LIKE :last LIMIT 1"</span>) </span><br><span class="line">    <span class="function">User <span class="title">findByName</span><span class="params">(String first, String last)</span></span>; </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Insert</span> <span class="keyword">void</span> </span><br><span class="line">    insertAll(User... users); </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Delete</span> <span class="keyword">void</span> </span><br><span class="line">    delete(User user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AppDatabase.java</span></span><br><span class="line"><span class="meta">@Database</span>(entities = &#123;User.class&#125;, version = <span class="number">1</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AppDatabase</span> <span class="keyword">extends</span> <span class="title">RoomDatabase</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> UserDao <span class="title">userDao</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>위 3개의 class가 완성되면 아래와 같이 DB의 instance를 얻을 수 있다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AppDatabase db = Roo.databaseBuilder(getApplicationContext(), AppDatabase.class, <span class="string">"database-name"</span>).build();</span><br></pre></td></tr></table></figure>
<p><code>AppDatabase object를 생성하는 코드는 비용이 많이 들기 때문에 싱글톤으로 구현해야 한다.</code></p>
<h2 id="entities">Entities</h2>
<p>@Database의 annotation에 속성으로 포함된 entitiy는 실제 @Entity annotation을 붙인 class로 만들어야 한다. 이는 각 table로 생성되며, 실제 colume으로 만들고 싶지 않은 field가 있다면 <code>@Ignore</code>를 붙인다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="meta">@PrimaryKey</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> String firstName;</span><br><span class="line">    <span class="keyword">public</span> String lastName;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Ignore</span></span><br><span class="line">    Bitmap picture;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Field는 public 형태이어야 하며, private으로 할 경우 getter와 setter를 java beans convention에 따라 만들어야 한다.</p>
<h2 id="primary-key">Primary Key</h2>
<p>column이 하나라도 PK는 지정되어야 한다. @PrimaryKey annotation을 이용하거나 복합 PK의 경우 @Entity 속성으로 primarykeys를 이용한다.</p>
<p>또한, Id를 autogenerate하려면 @PrimaryKey 속성에 <code>autoGenerate</code> 속성(true)을 넣는다.</p>
<p>추가적으로 class 이름은 table 명이 된다. table 명을 바꾸고 싶다면 @Entity 속성으로 <code>tableName</code>을 넣으면 된다.</p>
<p>만약 field 이름을 column으로 쓰고 싶지 않다면 <code>@ColumnInfo</code>로 표기해야 한다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 복합 PK 사용시</span></span><br><span class="line"><span class="meta">@Entity</span>(primaryKeys = &#123;<span class="string">"firstName"</span>, <span class="string">"lastName"</span>&#125;)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String firstName;</span><br><span class="line">    <span class="keyword">public</span> String lastName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Ignore</span></span><br><span class="line">    Bitmap picture;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 테이블 이름을 직접 지정할 때</span></span><br><span class="line"><span class="meta">@Entity</span>(tableName = <span class="string">"users"</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="comment">// 생략</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Column을 직접 지정할 때</span></span><br><span class="line"><span class="meta">@Entity</span>(tableName = <span class="string">"users"</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="meta">@PrimaryKey</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> uid;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ColumnInfo</span>(name = <span class="string">"first_name"</span>)</span><br><span class="line">    <span class="keyword">public</span> String firstName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ColumnInfo</span>(name = <span class="string">"last_name"</span>)</span><br><span class="line">    <span class="keyword">public</span> String lastName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Ignore</span></span><br><span class="line">    Bitmap picture;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="indices-and-uniqueness">Indices and uniqueness</h2>
<p>Indext는 아래와 같이 만들 수 있다.(결합 index도 생성 가능)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span>(indices = &#123;<span class="meta">@Index</span>(<span class="string">"name"</span>),<span class="meta">@Index</span>(value = &#123;<span class="string">"last_name"</span>,<span class="string">"address"</span>&#125;)&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Users</span> </span>&#123;</span><br><span class="line">    <span class="meta">@PrimaryKey</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> uid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String firstName;</span><br><span class="line">    <span class="keyword">public</span> String address;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ColumnInfo</span>(name = <span class="string">"last_name"</span>)</span><br><span class="line">    <span class="keyword">public</span> String lastName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Ignore</span></span><br><span class="line">    Bitmap picture;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Unique 제약 조건은 아래와 같이 표기할 수 있다.</li>
<li>예제) 결합 조건에 대한 unique index</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span>(indices = &#123;<span class="meta">@Index</span>(value = &#123;<span class="string">"first_name"</span>, <span class="string">"last_name"</span>&#125;,</span><br><span class="line">        unique = <span class="keyword">true</span>)&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Users</span> </span>&#123;</span><br><span class="line">    <span class="meta">@PrimaryKey</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> uid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ColumnInfo</span>(name = <span class="string">"first_name"</span>)</span><br><span class="line">    <span class="keyword">public</span> String firstName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ColumnInfo</span>(name = <span class="string">"last_name"</span>)</span><br><span class="line">    <span class="keyword">public</span> String lastName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Ignore</span></span><br><span class="line">    Bitmap picture;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>foreignKey도 설정할 수 있다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span>(foreignKeys = <span class="meta">@ForeignKey</span>(entity = User.class,</span><br><span class="line">        parentColumns = <span class="string">"id"</span>,</span><br><span class="line">        childColumns = <span class="string">"user_od"</span>))</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">    <span class="meta">@PrimaryKey</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> bookId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String title;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ColumnInfo</span>(name = <span class="string">"user_id"</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> useerId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="nested-objects">Nested objects</h2>
<p>Entity 클래스가 field로 object를 갖는 경우 <code>@Embeded</code>를 사용한다. 단, 해당 table에는 Embeded된 클래스의 column도 똑같은 하나의 column으로 취급된다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Address</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String street;</span><br><span class="line">    <span class="keyword">public</span> String state; <span class="keyword">public</span> String city;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ColumnInfo</span>(name = <span class="string">"post_code"</span>) </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> postCode;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="meta">@PrimaryKey</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String firstName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Embeded</span></span><br><span class="line">    <span class="keyword">public</span> Address address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>즉, 위 예제에서 User table에는 id, firstName, street, state, city, post_cde 컬럼이 존재한다. Embeded 안에서 embeded를 가질 수 있으며, 만약 column 이름이 중복되는 경우 <code>prefix</code>를 사용하여 unique하게 column 이름을 설정한다.</p>
<h2 id="daodata-access-objectsdaos">DAO(Data Access Objects)(DAOs)</h2>
<p>Dao는 abstract class나 interface가 될 수 있다. RoomDatabase를 인자로 받는 생성자를 만드는 경우에만 abstract class가 될 수 있다. Room은 절대로 main thread에서 query 작업을 하지 않는다. <code>allowMainThreadQueries()</code>를 호출하더라도 불가능하다.<br>
LiveData는 return하는 비동기 query의 경우에는 가능하다.(어차피 background에서 수행되므로) - 무슨 말이지…?</p>
<h3 id="insert">Insert</h3>
<p>@Insert로 표기하며, single transaction으로 처리된다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Dao</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Insert</span>(onConflict = OnConflictStrategy.REPLACE)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertUsers</span><span class="params">(User... users)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Insert</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertBothUser</span><span class="params">(User user1, User user2)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Insert</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertUsersAndFriends</span><span class="params">(User user, List&lt;User&gt; friends)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>@Entity로 정의된 class만 인자로 받거나, 그 class의 collection 또는 array만 인자로 받을 수 있다. 또한, 인자가 하나인 경우 long type의 return(insert된 값의 rowId)을 받을 수 있고, 여러 개인 경우 long[], List<long>을 받을 수 있다.</long></p>
<h3 id="update">Update</h3>
<p>Update를 사용하여 Entity set을 update 한다. return 값으로 변경된 rows 수를 받을 수 있다. update는 PK 기준으로 한다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Dao</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyDao</span></span>&#123;</span><br><span class="line">    <span class="meta">@Update</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUsers</span><span class="params">(User... user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="delete">Delete</h3>
<p><code>Delete</code>를 사용하여 Entity set을 delete 한다. return 값으로 변경된 rows 수를 받을 수 있다. 삭제 key는 PK를 기준으로 한다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Dao</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyDao</span></span>&#123;</span><br><span class="line">    <span class="meta">@Delete</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUsers</span><span class="params">(User... users)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="query">Query</h3>
<p><code>@Query</code>를 사용하여 DB를 조회할 수 있다. compile time에 return되는 object의 field와 sql 결과로 나오는 column의 이름이 맞는지 확인하여 일부가 match되면 warning, match 되는게 없다면 error를 보낸다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Dao</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyDao</span></span>&#123;</span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"SELECT * FROM user"</span>)</span><br><span class="line">    <span class="keyword">public</span> User[] loadAllUsers();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>select문에 parameter가 들어가야 하는 경우 아래와 같이 넣을 수 있다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Dao</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyDao</span></span>&#123;</span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"SELECT * FROM user WHERE age &gt; :minAge"</span>)</span><br><span class="line">    <span class="keyword">public</span> User[] loadAllUsersOlderThan(<span class="keyword">int</span> minAge);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>아래와 같이 여러 개의 parameter도 사용할 수 있다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Dao</span> <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyDao</span> </span>&#123; </span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"SELECT * FROM user WHERE age BETWEEN :minAge AND :maxAge"</span>) </span><br><span class="line">    <span class="keyword">public</span> User[] loadAllUsersBetweenAges(<span class="keyword">int</span> minAge, <span class="keyword">int</span> maxAge); </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"SELECT * FROM user WHERE first_name LIKE :search "</span> + <span class="string">"OR last_name LIKE :search"</span>) </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findUserWithName</span><span class="params">(String search)</span></span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>만약 일부 컬럼만 조회하고 싶다면 따로 return class를 만들어서 요청할 수 있다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// return 받을 class를 정의</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NameTuple</span></span>&#123;</span><br><span class="line">    <span class="meta">@ColumnInfo</span>(name = <span class="string">"first_name"</span>)</span><br><span class="line">    <span class="keyword">public</span> String firstName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ColumnInfo</span>(name=<span class="string">"last_name"</span>) </span><br><span class="line">    <span class="keyword">public</span> String lastName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Dao</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyDao</span></span>&#123;</span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"SELECT first_name, last_name FROM user"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;NameTuple&gt; <span class="title">loadFullName</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>또한, 정해지지 않은 개수의 parameter가 넘어가야 하는 경우 아래와 같이 수행 가능하다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Dao</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyDao</span> </span>&#123; </span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"SELECT first_name, last_name FROM user WHERE region IN (:regions)"</span>) </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;NameTuple&gt; <span class="title">loadUsersFromRegions</span><span class="params">(List&lt;String&gt; regions)</span></span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>기타 등등의 기능들을 포함하고 있다. 하지만, 아래는 필요에 따라 찾아보면서 기능을 사용하면 될 것 같다.</p>
<h3 id="using-tye-converters">Using tye converters</h3>
<p>Room은 primitive type(원시 타입 ex. int, String 등등)과 그 wrapping 타입만 지원한다. 하지만, 그 외에 type을 사용할 경우 <strong>TypeConverter</strong>를 사용하여 type을 치환해야 한다.</p>
<p>예를 들어, DB에서는 timestamp로 되어 있고, java code에서는 Date class로 되어 있는 경우 우선 아래와 같이 <code>converter</code>를 만든다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Converters</span></span>&#123;</span><br><span class="line">    <span class="meta">@TypeConverter</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title">fromTimestamp</span><span class="params">(Long value)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value == <span class="keyword">null</span>? <span class="keyword">null</span> : <span class="keyword">new</span> Date(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TypeConverter</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title">dateToTimestamp</span><span class="params">(Date date)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> date == <span class="keyword">null</span>? <span class="keyword">null</span> : date.getTime();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>이 두개의 converting 함수는 서로 converting 해주고 있다.</li>
<li><code>@TypeConverters</code>를 이용하여 적용할 곳에 넣는다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AppDatabase.java</span></span><br><span class="line"><span class="meta">@Database</span>(entities = &#123;User.java&#125;, version= <span class="number">1</span>)</span><br><span class="line"><span class="meta">@TypeConverters</span>(&#123;Converters.class&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AppDatabase</span> <span class="keyword">extends</span> <span class="title">RoomDatabase</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> UserDao <span class="title">userDao</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// User.java</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UserDao.java</span></span><br><span class="line"><span class="meta">@Dao</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"SELECT * FROM user WHERE birthday BETWEEN :from AND :to"</span>)</span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findUsersBornBetweenDates</span><span class="params">(Date from, Date to)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>@TypeConverter를 지정하는 위치에 따라 scope이 달라진다.</li>
<li>예제처럼 Database에 넣으면 Dao와 entity 모두 영향을 받는다.</li>
<li>Dao나 Entity, POJO에 넣을 수도 있고, Entity의 특정 field, Dao의 특정 method or 특정 parameter에 넣을 수 있다.</li>
</ul>
<h3 id="database-migration">Database migration</h3>
<p>database migration이 필요한 경우 entity class에 수정 항목을 반영해야 한다. 또한 데이터를 날리지 않기 위해서 mirgration을 할 수 있는 방법을 제공한다.</p>
<p>migration을 등록하면, runtime에 migration을 수행하며 정해놓은 순서대로 migration이 가능하다. migration을 등록할 때는 <strong>시작 버전과 끝 버전을 넣어야 한다.</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Room.databaseBuilder(getApplicationContext(), MyDb.class, <span class="string">"database-name"</span>).addMigrations(MIGRATION_1_2, MIGRATION_2_3).build();</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> Migration MIGRATION_1_2 = <span class="keyword">new</span> Migration(<span class="number">1</span>,<span class="number">2</span>)&#123;</span><br><span class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">migrate</span><span class="params">(SupportSQLiteDatabase database)</span> </span>&#123; </span><br><span class="line">        database.execSQL(<span class="string">"CREATE TABLE `Fruit` (`id` INTEGER, "</span> + <span class="string">"`name` TEXT, PRIMARY KEY(`id`))"</span>); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> Migration MIGRATION_2_3 = <span class="keyword">new</span> Migration(<span class="number">2</span>, <span class="number">3</span>) &#123; </span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">migrate</span><span class="params">(SupportSQLiteDatabase database)</span> </span>&#123; </span><br><span class="line">        database.execSQL(<span class="string">"ALTER TABLE Book "</span> + <span class="string">" ADD COLUMN pub_year INTEGER"</span>); </span><br><span class="line">        &#125; </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>migration 코드가 없으면 Room은 DB를 그냥 rebuild한다.</code>(기존 데이터는 날아간다.)</li>
<li>또한, migration에 들어가는 query는 상수에 넣지말고, 직접 넣는게 migration 로직을 유지하는데더 좋다.</li>
<li>migration이 끝나고 나면, schema에 대한 유효성을 확인을 하고, 문제가 있을 경우 mismatch된 부분에 정보를 담은 exception을 발생 시킨다.</li>
</ul>
<h2 id="참고">참고</h2>
<ul>
<li><a href="https://tourspace.tistory.com/28" target="_blank" rel="noopener">Android Architecture Components #6 - Room</a></li>
<li><a href="https://developer.android.com/training/data-storage/room/defining-data#java" target="_blank" rel="noopener">Defining data using Room entities</a></li>
<li><a href="https://developer.android.com/training/data-storage/room/#java" target="_blank" rel="noopener">Save data in a local database using Room</a></li>
</ul>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2019/01/25/Android-Room-Basic/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
          <li class="pagination-prev">
            <a
                class="btn btn--default btn--small"
                href="/archives/archives/11/"
                aria-label="NEWER POSTS"
            >
              <i class="fa fa-angle-left text-base icon-mr"></i>
              <span>NEWER POSTS</span>
            </a>
          </li>
        
        
          <li class="pagination-next">
            <a
                class="btn btn--default btn--small"
                href="/archives/archives/13/"
                aria-label="OLDER POSTS"
            >
              <span>OLDER POSTS</span>
              <i class="fa fa-angle-right text-base icon-ml"></i>
            </a>
          </li>
        
        <li class="pagination-number">page 12 of 28</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2020 VictoryWoo. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/Victory.jpeg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">VictoryWoo</h4>
        
            <div id="about-card-bio"><p>기록을 통해 사람들과 공유하는 것을 좋아합니다.</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Android Developer</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover-v1.2.0.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/jquery.js"></script>
<script src="/assets/js/jquery.fancybox.js"></script>
<script src="/assets/js/thumbs.js"></script>
<script src="/assets/js/tranquilpeak.js"></script>
<!--SCRIPTS END-->





    </body>
</html>
